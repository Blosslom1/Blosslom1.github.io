<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Django | 星炎实验室</title><meta name="description" content="重型web后端开发框架"><meta name="keywords" content="web"><meta name="author" content="Blosslom&amp;纽扣,1215057638@qq.com"><meta name="copyright" content="Blosslom&amp;纽扣"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/Blosslom1/img@master/favicon.png"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="dns-prefetch" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="https://hm.baidu.com"/><link rel="dns-prefetch" href="https://hm.baidu.com"/><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin="crossorigin"/><link rel="dns-prefetch" href="https://fonts.googleapis.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="dns-prefetch" href="//busuanzi.ibruce.info"/><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Django"><meta name="twitter:description" content="重型web后端开发框架"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/django/head.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Django"><meta property="og:url" content="https://blosslom1.github.io/2022/03/06/Django/"><meta property="og:site_name" content="星炎实验室"><meta property="og:description" content="重型web后端开发框架"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/django/head.jpg"><meta property="article:published_time" content="2022-03-06T11:10:55.000Z"><meta property="article:modified_time" content="2022-05-19T13:44:15.192Z"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>var autoChangeMode = '1'
var t = Cookies.get("theme")
if (autoChangeMode == '1'){
  var isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
  var isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
  var isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined){
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport){
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour < 9 || hour >= 14
      isNight ? activateDarkMode() : activateLightMode()
  }
  } else if (t == 'light') activateLightMode()
  else activateDarkMode()

} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://blosslom1.github.io/2022/03/06/Django/"><link rel="next" title="模具设计" href="https://blosslom1.github.io/2021/11/04/%E6%A8%A1%E5%85%B7%E8%AE%BE%E8%AE%A1/"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?563f0966f2e6b9657febdcd266f82b0c";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容:${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: undefined,
  ClickShowText: {"text":"富強,民主,文明,和諧,自由,平等,公正,法治,愛國,敬業,誠信,友善","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  highlightShrink: 'false',
  isFontAwesomeV5: false,
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
  
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isSidebar: true  
  }</script><noscript><style>
#page-header {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://cdn.jsdelivr.net/gh/Blosslom1/img@master/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">40</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">28</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">14</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 相册</span></a></li></ul></div></div></div></div><i class="fa fa-arrow-right on" id="toggle-sidebar" aria-hidden="true">     </i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#django"><span class="toc-number">1.</span> <span class="toc-text"> Django</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#新建"><span class="toc-number">1.1.</span> <span class="toc-text"> 新建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#启动服务"><span class="toc-number">1.2.</span> <span class="toc-text"> 启动服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#文件配置"><span class="toc-number">1.3.</span> <span class="toc-text"> 文件配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#settings文件"><span class="toc-number">1.3.1.</span> <span class="toc-text"> settings文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#url文件uniform-resource-locator统一资源定位符"><span class="toc-number">1.3.2.</span> <span class="toc-text"> URL文件（Uniform Resource Locator统一资源定位符）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#请求及相应"><span class="toc-number">1.4.</span> <span class="toc-text"> 请求及相应</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#getpost"><span class="toc-number">1.4.1.</span> <span class="toc-text"> GET&amp;POST</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板"><span class="toc-number">1.5.</span> <span class="toc-text"> 模板</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面向对象"><span class="toc-number">1.6.</span> <span class="toc-text"> 面向对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板标签"><span class="toc-number">1.7.</span> <span class="toc-text"> 模板标签</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#if标签"><span class="toc-number">1.7.1.</span> <span class="toc-text"> if标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#for标签"><span class="toc-number">1.7.2.</span> <span class="toc-text"> for标签</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模板的继承"><span class="toc-number">1.7.3.</span> <span class="toc-text"> 模板的继承</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#静态资源标签"><span class="toc-number">1.7.4.</span> <span class="toc-text"> 静态资源标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#url反向解析"><span class="toc-number">1.8.</span> <span class="toc-text"> URL反向解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#静态文件配置"><span class="toc-number">1.9.</span> <span class="toc-text"> 静态文件配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用"><span class="toc-number">1.10.</span> <span class="toc-text"> 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#分布式路由"><span class="toc-number">1.10.1.</span> <span class="toc-text"> 分布式路由</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#orm"><span class="toc-number">1.11.</span> <span class="toc-text"> ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#windows系统数据库部署"><span class="toc-number">1.11.1.</span> <span class="toc-text"> windows系统数据库部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#linux系统"><span class="toc-number">1.11.2.</span> <span class="toc-text"> Linux系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编写model"><span class="toc-number">1.11.3.</span> <span class="toc-text"> 编写model</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#数据库迁移"><span class="toc-number">1.11.3.1.</span> <span class="toc-text"> 数据库迁移</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#字段选项"><span class="toc-number">1.11.4.</span> <span class="toc-text"> 字段选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#meta类"><span class="toc-number">1.11.5.</span> <span class="toc-text"> Meta类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#文件记录"><span class="toc-number">1.11.6.</span> <span class="toc-text"> 文件记录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#管理器对象"><span class="toc-number">1.11.7.</span> <span class="toc-text"> 管理器对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建数据方法"><span class="toc-number">1.11.7.1.</span> <span class="toc-text"> 创建数据方法</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#django-shell"><span class="toc-number">1.11.8.</span> <span class="toc-text"> Django Shell</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#orm查询"><span class="toc-number">1.11.9.</span> <span class="toc-text"> ORM查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#条件查询"><span class="toc-number">1.11.9.1.</span> <span class="toc-text"> 条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#filter"><span class="toc-number">1.11.9.1.1.</span> <span class="toc-text"> filter()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#exclude"><span class="toc-number">1.11.9.1.2.</span> <span class="toc-text"> exclude()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#get"><span class="toc-number">1.11.9.1.3.</span> <span class="toc-text"> get()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#语法mymodelobjectsget属性1值1属性2值2"><span class="toc-number">1.11.9.2.</span> <span class="toc-text"> 语法:MyModel.objects.get(属性1&#x3D;值1，属性2&#x3D;值2)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询谓语词"><span class="toc-number">1.11.9.3.</span> <span class="toc-text"> 查询谓语词</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#__exact"><span class="toc-number">1.11.9.3.1.</span> <span class="toc-text"> __exact</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__contains"><span class="toc-number">1.11.9.3.2.</span> <span class="toc-text"> __contains</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__startswith"><span class="toc-number">1.11.9.3.3.</span> <span class="toc-text"> __startswith</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__endswith"><span class="toc-number">1.11.9.3.4.</span> <span class="toc-text"> __endswith</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__gt"><span class="toc-number">1.11.9.3.5.</span> <span class="toc-text"> __gt</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__gte"><span class="toc-number">1.11.9.3.6.</span> <span class="toc-text"> __gte</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__lt"><span class="toc-number">1.11.9.3.7.</span> <span class="toc-text"> __lt</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__lte"><span class="toc-number">1.11.9.3.8.</span> <span class="toc-text"> __lte</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__in"><span class="toc-number">1.11.9.3.9.</span> <span class="toc-text"> __in</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#__range"><span class="toc-number">1.11.9.3.10.</span> <span class="toc-text"> __range</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#增删操作"><span class="toc-number">1.11.9.4.</span> <span class="toc-text"> 增删操作</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#伪删除"><span class="toc-number">1.11.10.</span> <span class="toc-text"> 伪删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#f和q对象"><span class="toc-number">1.11.11.</span> <span class="toc-text"> F和Q对象</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#f对象"><span class="toc-number">1.11.11.1.</span> <span class="toc-text"> F对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#q对象"><span class="toc-number">1.11.11.2.</span> <span class="toc-text"> Q对象</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#聚合查询"><span class="toc-number">1.11.12.</span> <span class="toc-text"> 聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#整表聚合"><span class="toc-number">1.11.12.1.</span> <span class="toc-text"> 整表聚合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#分组聚合"><span class="toc-number">1.11.12.2.</span> <span class="toc-text"> 分组聚合</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#原生数据库操作"><span class="toc-number">1.11.13.</span> <span class="toc-text"> 原生数据库操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#cursor"><span class="toc-number">1.11.13.1.</span> <span class="toc-text"> cursor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#内容修改"><span class="toc-number">1.11.14.</span> <span class="toc-text"> 内容修改</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#音乐名管理系统"><span class="toc-number">1.11.14.1.</span> <span class="toc-text"> 音乐名管理系统</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#admin"><span class="toc-number">1.12.</span> <span class="toc-text"> admin</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#自定义模型类"><span class="toc-number">1.12.1.</span> <span class="toc-text"> 自定义模型类</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#模型管理器类"><span class="toc-number">1.12.1.1.</span> <span class="toc-text"> 模型管理器类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#simple-ui"><span class="toc-number">1.12.1.2.</span> <span class="toc-text"> simple ui</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#关系映射"><span class="toc-number">1.13.</span> <span class="toc-text"> 关系映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#一对一映射"><span class="toc-number">1.13.1.</span> <span class="toc-text"> 一对一映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建"><span class="toc-number">1.13.1.1.</span> <span class="toc-text"> 创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询"><span class="toc-number">1.13.1.2.</span> <span class="toc-text"> 查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#一对多映射"><span class="toc-number">1.13.2.</span> <span class="toc-text"> 一对多映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-2"><span class="toc-number">1.13.2.1.</span> <span class="toc-text"> 创建</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#查询-2"><span class="toc-number">1.13.2.2.</span> <span class="toc-text"> 查询</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多对多映射"><span class="toc-number">1.13.3.</span> <span class="toc-text"> 多对多映射</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-3"><span class="toc-number">1.13.3.1.</span> <span class="toc-text"> 创建</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cookiessession"><span class="toc-number">1.14.</span> <span class="toc-text"> cookies&amp;session</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#哈希算法"><span class="toc-number">1.15.</span> <span class="toc-text"> 哈希算法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#缓存"><span class="toc-number">1.16.</span> <span class="toc-text"> 缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#全局缓存"><span class="toc-number">1.16.1.</span> <span class="toc-text"> 全局缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#局部缓存"><span class="toc-number">1.16.2.</span> <span class="toc-text"> 局部缓存</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#浏览器缓存"><span class="toc-number">1.16.3.</span> <span class="toc-text"> 浏览器缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#中间件"><span class="toc-number">1.17.</span> <span class="toc-text"> 中间件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csrf跨站伪造请求攻击"><span class="toc-number">1.18.</span> <span class="toc-text"> CSRF跨站伪造请求攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#csv文件"><span class="toc-number">1.19.</span> <span class="toc-text"> CSV文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上传"><span class="toc-number">1.20.</span> <span class="toc-text"> 上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在前端"><span class="toc-number">1.20.1.</span> <span class="toc-text"> 在前端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在后端"><span class="toc-number">1.20.2.</span> <span class="toc-text"> 在后端</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在setting中"><span class="toc-number">1.20.3.</span> <span class="toc-text"> 在setting中</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#邮件发送"><span class="toc-number">1.21.</span> <span class="toc-text"> 邮件发送</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#环境部署"><span class="toc-number">1.22.</span> <span class="toc-text"> 环境部署</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis"><span class="toc-number">1.23.</span> <span class="toc-text"> redis</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#项目"><span class="toc-number">1.24.</span> <span class="toc-text"> 项目</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><div id="web_bg" data-type="color"></div><div class="post-bg" id="nav" style="background-image: url(https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/django/head.jpg)"><div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">星炎实验室</a></span><span class="pull_right menus"><div id="search_button"><a class="site-page social-icon search"><i class="fa fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> 友情链接</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fa fa-list" aria-hidden="true"></i><span> 其他</span><i class="fa fa-chevron-down menus-expand" aria-hidden="true"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page" href="/movie/"><i class="fa-fw fa fa-film"></i><span> 视频</span></a></li><li><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-picture-o"></i><span> 相册</span></a></li></ul></div></div><span class="toggle-menu close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span></span></div><div id="post-info"><div id="post-title"><div class="posttitle">Django</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2022-03-06 19:10:55"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2022-03-06</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2022-05-19 21:44:15"><i class="fa fa-history" aria-hidden="true"></i> 更新于 2022-05-19</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/">计算机</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="post-meta__icon fa fa-file-word-o" aria-hidden="true"></i><span>字数总计:</span><span class="word-count">17.4k</span><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-clock-o" aria-hidden="true"></i><span>阅读时长: 68 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="fa fa-eye post-meta__icon" aria-hidden="true"> </i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="post-meta__icon fa fa-comment-o" aria-hidden="true"></i><span>评论数:</span><a href="/2022/03/06/Django/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2022/03/06/Django/" itemprop="commentCount"></span></a></span></div></div></div></div><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="django"><a class="markdownIt-Anchor" href="#django"></a> Django</h1>
<h2 id="新建"><a class="markdownIt-Anchor" href="#新建"></a> 新建</h2>
<p>支持Python的版本–3.5，3.6，3.7，3.8·在线安装<br />
虚拟机执行sudo pip3 install django==3.2.12 检查是否成功sudo pip3 freezelgrep -i ‘Django’</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tarena@tedu :~$ sudo pip3 freeze|grep -i 'Django '</span><br><span class="line">Django==2.2.12</span><br></pre></td></tr></table></figure>
<p>有该输出代表成功</p>
<p>·离线安装–官网下载离线安装包<br />
·将安装包复制到虚拟机<br />
·解压缩tar -xvf Django-2.2.12.tar.gz·进入目录cd Django-2.2.12<br />
·执行安装sudo python3 <a href="http://setup.py" target="_blank" rel="noopener">setup.py</a> install<br />
·检查是否成功sudo pip3 freeze|grep -i ‘Django’</p>
<h2 id="启动服务"><a class="markdownIt-Anchor" href="#启动服务"></a> 启动服务</h2>
<p>启动[测试开发阶段]</p>
<ul>
<li>1．终端cd进入到项目文件夹，例如cd mysite1</li>
<li>2．进入到项目文件夹后，执行python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver 端口启动django服务【注:该启动方式下，Django在前台启动服务，默认监听8000端口】</li>
<li>3．浏览器访问http://127.0.0.1:8000可看到django的启动页面注:【如果想更换端口，则可以用python.3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver端口号】</li>
</ul>
<p>·关闭服务<br />
方式1:在runserver启动终端下执行Ctrl +c可关闭Django服务·</p>
<p>方式2:在其他终端下执行sudo lsof -i:8000查询出Django的进程id执行kill -9对应Django进程id</p>
<p>使用python manage.py查看可以启动的服务</p>
<p>settings.py包含了Django项目启动的所有配置项·配置项分为公有配置和自定义配置<br />
·配置项格式例:(BASE_DIR’xxx‘）变量名一定要大写</p>
<p>公有配置- jango<a href="https://docs.djangoproject.com/en/2.2/ref/settings/" target="_blank" rel="noopener">官方提供的基础配置</a></p>
<h2 id="文件配置"><a class="markdownIt-Anchor" href="#文件配置"></a> 文件配置</h2>
<h3 id="settings文件"><a class="markdownIt-Anchor" href="#settings文件"></a> settings文件</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">BASE_DIR<span class="comment">#项目的路径</span></span><br><span class="line">DEBUG = <span class="literal">True</span> <span class="comment">#表示处于开发模式False上线模式</span></span><br><span class="line">ALLOWED_HOSTS = []<span class="comment">#请求头，使用网站域名</span></span><br><span class="line">TIME_ZONE = <span class="string">"Asia/Shanghai"</span></span><br></pre></td></tr></table></figure>
<p>BASE_DIR<br />
用于绑定当前项目的绝对路径(动态计算出来的)这个路径是…/项目文件名，所有文件<br />
夹都可以依懒此路径<br />
DEBUG<br />
用于配置Django项目的启动模式，取值:<br />
True表示开发环境中使用开发调试模式(用于开发中). False表示当前项目运行在生产环境中</p>
<ul>
<li>INSTALLED_APPS -指定当前项目中安装的应用列表</li>
<li>MIDDLEWARE -用于注册中间件</li>
<li>TEMPLATES -用于指定模板的配置信息</li>
<li>DATABASES -用于指定数据库的配置信息</li>
<li>LANGUAGE_CODE-用于指定语言配置</li>
</ul>
<p>ALLOWED HOSTS<br />
示例:如果要在局域网其它主机也能访问此主机的Django服务，启动方式如下:<br />
python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver<br />
0.0.0.0:5000<br />
指定网络设备如果内网环境下其他主机想正常访问该站点,<br />
需加ALLOWED_HOSTS =['内网ip]</p>
<p>ROOT_URLCONF -用于配置主url配置’mysite1.urls’.</p>
<p>设置中文（在settings文件中）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.utils.translation <span class="keyword">import</span> gettext_lazy <span class="keyword">as</span> _</span><br><span class="line">LANGUAGES = [</span><br><span class="line">    (<span class="string">'zh-Hans'</span>, _(<span class="string">'Chinese'</span>)),</span><br><span class="line">]</span><br><span class="line">LANGUAGE_CODE = <span class="string">"zh-Hans"</span></span><br></pre></td></tr></table></figure>
<p>LANGUAGE_CODE = “zh-Hans”</p>
<h3 id="url文件uniform-resource-locator统一资源定位符"><a class="markdownIt-Anchor" href="#url文件uniform-resource-locator统一资源定位符"></a> URL文件（Uniform Resource Locator统一资源定位符）</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views<span class="comment">#导入当前目录下的views文件</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">    path(<span class="string">''</span>,views.main),<span class="comment">#网站首页</span></span><br><span class="line">    path(<span class="string">'page/'</span>,views.函数名)<span class="comment">#在views文件中定义的函数名不能带括号</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>url分配地址</p>
<p>path()函数</p>
<ul>
<li>导入- from django.urls.import path</li>
<li>语法- path(route, views, name=None)</li>
</ul>
<p>参数:</p>
<ul>
<li>route:字符串类型，匹配的请求路径</li>
<li>views:指定路径所对应的视图处理函数的名称</li>
<li>name:为地址起别名，在模板地址反向解析时使用</li>
</ul>
<p><a href="http://xn--views-fg1hqcvmn9dda134lma709gvqa81wozypozha88el60yis7d2tyc.py" target="_blank" rel="noopener">在同名的文件夹下面新建一个视图文件views.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_one</span><span class="params">(request)</span>:</span></span><br><span class="line">    html=<span class="string">"&lt;h1&gt;this is a page&lt;h2&gt;"</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>
<p>path转换器<br />
语法:&lt;转换器类型:自定义名&gt;<br />
作用:若转换器类型匹配到对应类型的数据，则将数据按照关键字传参的方式传递给视图函数<br />
例子:path(‘page/&lt;int:page&gt;’, <a href="http://views.xxx" target="_blank" rel="noopener">views.xxx</a>)</p>
<table>
<thead>
<tr>
<th>转化器类型</th>
<th>作用</th>
<th>案例</th>
<th>可匹配</th>
</tr>
</thead>
<tbody>
<tr>
<td>str</td>
<td>匹配除了’/'之外的非空字符串</td>
<td>page/&lt;str:user&gt;</td>
<td>page/Bloss</td>
</tr>
<tr>
<td>int</td>
<td>匹配0或任何整数，返回int型</td>
<td>page/&lt;int:num&gt;</td>
<td>page/10</td>
</tr>
<tr>
<td>slug</td>
<td>匹配任意由ASCII字母或数字以及连字符和下划线组成的短标签</td>
<td>page/&lt;slug:sl&gt;</td>
<td>page/im-am</td>
</tr>
<tr>
<td>path</td>
<td>匹配任意由ASCII字母或数字以及连字符和下划线组成的短标签</td>
<td>page/&lt;path:ph&gt;</td>
<td>page/1/v/</td>
</tr>
</tbody>
</table>
<p>在url文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'page/&lt;int:num1&gt;/&lt;str:way&gt;/&lt;int:num2&gt;'</span>, views.page_num),</span><br></pre></td></tr></table></figure>
<p>在views文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">page_num</span><span class="params">(request, num1, way, num2)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> way == <span class="string">"add"</span>:</span><br><span class="line">        html = <span class="string">f"&lt;h1&gt; <span class="subst">&#123;num1&#125;</span> <span class="subst">&#123;way&#125;</span><span class="subst">&#123;num2&#125;</span>=<span class="subst">&#123;num1 + num2&#125;</span>&lt;h1&gt;"</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>
<p>三个参数传入view文件中的page_num函数</p>
<p>re_path()函数<br />
在url的匹配过程中可以使用正则表达式进行精确匹配</p>
<p>语法:<br />
re_path(reg, view, name=xxx)</p>
<p>正则表达式为命名分组模式(?P<name>pattern);匹配提取参数后用关键字传参方式传递给视图函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, re_path</span><br><span class="line"></span><br><span class="line">re_path(<span class="string">r''</span>,view)</span><br></pre></td></tr></table></figure>
<h2 id="请求及相应"><a class="markdownIt-Anchor" href="#请求及相应"></a> 请求及相应</h2>
<table>
<thead>
<tr>
<th>序号</th>
<th>方法</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>GET</td>
<td>请求指定的页面信息，并返回实体主体。</td>
</tr>
<tr>
<td>2</td>
<td>HEAD</td>
<td>类似于get请求，只不过返回的响应中没有具体的内容，用于获取报头</td>
</tr>
<tr>
<td>2</td>
<td>POST</td>
<td>向指定资源提交数据进行处理请求（例如提交表单或者上传文件)。数据被包含在请求体中。POST请求可能会导致新的资源的建立和/或已有资源的修改。</td>
</tr>
<tr>
<td>4</td>
<td>PUT</td>
<td>从客户端向服务器传送的数据取代指定的文档的内</td>
</tr>
<tr>
<td>5</td>
<td>DELETE</td>
<td>请求服务器删除指定的页面。</td>
</tr>
<tr>
<td>6</td>
<td>CONNECT</td>
<td>HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</td>
</tr>
<tr>
<td>7</td>
<td>OPTIONS</td>
<td>允许客户端查看服务器的性能。</td>
</tr>
<tr>
<td>8</td>
<td>TRACE</td>
<td>回显服务器收到的请求，主要用于测试或诊断。</td>
</tr>
</tbody>
</table>
<p>Django中的请求</p>
<p>path_info: URL字符串<br />
method:字符串，表示HTTP请求方法，常用值:‘GET’、“POST”<br />
GET: QueryDict查询字典的对象，包含get请求方式的所有数据<br />
POST: QueryDict查询字典的对象，包含post请求方式的所有数据<br />
FILES:类似于字典的对象,包含所有的上传文件信息</p>
<p>在views文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">methond</span><span class="params">(request)</span>:</span></span><br><span class="line">    print(request.method)</span><br><span class="line">    print(request.path_info)</span><br><span class="line">    print(request.GET)</span><br><span class="line">    print(request.get_full_path)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"this is test"</span>)</span><br></pre></td></tr></table></figure>
<p>例如GET方法，当浏览器中传入参数时www.***.com/methond?a=8</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt;</span><br><span class="line">GET</span><br><span class="line">/methond</span><br><span class="line">&lt;QueryDict: &#123;<span class="string">'a'</span>: [<span class="string">'8'</span>]&#125;&gt;</span><br><span class="line">&lt;bound method HttpRequest.get_full_path of &lt;WSGIRequest: GET <span class="string">'/methond?a=8'</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>COOKIES: Python字典，包含所有的cookie，键和值都为字符串</p>
<p>session:似于字典的对象,表示当前的会话</p>
<p>body:字符串，请求体的内容(POST或PUT)</p>
<p>scheme:请求协议(‘http’/‘https’)</p>
<p>request.get_full_path():请求的完整路径</p>
<p>request.META:请求中的元数据(消息头)</p>
<ul>
<li>
<p>request.META[‘REMOTE ADDR’]:客户端IP地址</p>
</li>
<li>
<p>200请求成功</p>
</li>
<li>
<p>301永久重定向-资源(网页等)被永久转移到其它URL-</p>
</li>
<li>
<p>302 临时重定向</p>
</li>
<li>
<p>404-请求的资源(网页等)不存在-</p>
</li>
<li>
<p>500内部服务器错误</p>
</li>
</ul>
<p>构造函数格式:<br />
HttpResponse(content=响应体, content_type=响应体数据类型, status=状态码)<br />
作用:<br />
向客户端浏览器返回响应,同时携带响应体内容</p>
<ul>
<li>
<p>'text/html’(默认的,html文件)</p>
</li>
<li>
<p>'text/plain’(纯文本)</p>
</li>
<li>
<p>‘text/css’ (css文件)</p>
</li>
<li>
<p>‘text/javascript’ (js文件)</p>
</li>
<li>
<p>'multipart/form-data’(文件提交)</p>
</li>
<li>
<p>‘application/json’ (json传输)- ‘application/xml’ (xml文件)数据类型, status=状态码)</p>
<ul>
<li>
<table>
<thead>
<tr>
<th>类型</th>
<th>作用</th>
<th>状态码</th>
</tr>
</thead>
<tbody>
<tr>
<td>HttpResponseRedirect</td>
<td>重定向</td>
<td>302</td>
</tr>
<tr>
<td>HttpResponseNotModified</td>
<td>未修改</td>
<td>304</td>
</tr>
<tr>
<td>HttpResponseBadRequest</td>
<td>错误请求</td>
<td>400</td>
</tr>
<tr>
<td>HttpResponseNotFound</td>
<td>无对应资源</td>
<td>404</td>
</tr>
<tr>
<td>HttpResponseForbidden</td>
<td>请求被禁止</td>
<td>403</td>
</tr>
<tr>
<td>HttpResponseServerError</td>
<td>服务器错误</td>
<td>500</td>
</tr>
</tbody>
</table>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse,HttpResponseRedirect<span class="comment">#使用的上面的表格内容</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">anchor</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(<span class="string">'/admin/'</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="getpost"><a class="markdownIt-Anchor" href="#getpost"></a> GET&amp;POST</h3>
<p>通常在views中先进行判断使用的哪个方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_get</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        print(request.GET[<span class="string">"a"</span>])</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"this is get test"</span>)</span><br></pre></td></tr></table></figure>
<p>在浏览器中输入www.***.com/methond?a=8，则在终端中会打印出1，如果没有参数传入则会报错</p>
<p>使用request.GET.get方法可以解决无参数传入不报错的情况，输出no</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_get</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        print(request.GET.get(<span class="string">"a"</span>,<span class="string">"no"</span>))<span class="comment">#注意括号</span></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"this is get test"</span>)</span><br></pre></td></tr></table></figure>
<p>在又多个相同参数名传入不同参数时，使用GET.get.getlist()。应用场景时同一个键值传入多个数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_get</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        print(request.GET.getlist(<span class="string">"a"</span>))<span class="comment">#注意括号</span></span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">"this is get test"</span>)</span><br></pre></td></tr></table></figure>
<p>在浏览器中输入www.***.com/methond?a=8&amp;a=50s</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;[<span class="string">'1'</span>, <span class="string">'50'</span>]</span><br></pre></td></tr></table></figure>
<p>使用post接收传入的数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">POST_FORM = <span class="string">"""</span></span><br><span class="line"><span class="string">    &lt;form method="POST" action="/test_get_post"&gt;</span></span><br><span class="line"><span class="string">        用户名:&lt;input type="text" name="username"</span></span><br><span class="line"><span class="string">        &lt;input type="submit" value="提交"&gt;</span></span><br><span class="line"><span class="string">    &lt;/form&gt;</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_get</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        print(request.POST[<span class="string">"username"</span>])</span><br><span class="line">    <span class="keyword">else</span>:</span><br></pre></td></tr></table></figure>
<p>CSRF请求终端，防止CSRF网络攻击。在setting中注释掉csrf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-禁止掉 settings.py</span><br><span class="line">中MIDDLEWARE中的&#39;django.middleware.csrf.CsrfViewMiddleware&#39;的中间件</span><br></pre></td></tr></table></figure>
<p>传统MVC代表 Model-View-Controller(模型-视图-控制器)模式。<br />
√M模型层(Model),主要用于对数据库层的封装<br />
√V视图层(View)，用于向用户展示结果(WHAT+ HOW )<br />
√C控制(Controller ,用于处理请求、获取数据、返回结果(重要)</p>
<p>作用：降低模块耦合度</p>
<p>django的MTV代表 Model-Template-View(模型-模板-视图)模式。<br />
√ M模型层(Model)负责与数据库交互<br />
√T模板层(Template)负责呈现内容到浏览器(HOW)<br />
√V视图层(View）是核心，负责接收请求、获取数据、返回结果(WHAT)作用:降低模块间的耦合度(解耦)</p>
<h2 id="模板"><a class="markdownIt-Anchor" href="#模板"></a> 模板</h2>
<p>创建模板文件夹&lt;项目名&gt;/templates在settings.py 中TEMPLATES配置项<br />
1.BACKEND:指定模板的引擎</p>
<ol start="2">
<li>DIRS:模板的搜索目录(可以是一个或多个)</li>
<li>APP_DIRS∶是否要在应用中的templates 文件夹中搜索模板文件</li>
<li>OPTIONS:有关模板的选项<br />
·配置项中需要修改部分<br />
设置DIRS - 'DIRS&quot;: [os.path.join(BASE_DIR, ‘templates’)],</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'DIRS": [os.path.join(BASE_DIR, '</span>templates<span class="string">')],</span></span><br><span class="line"><span class="string">'</span>DIRS<span class="string">': [BASE_DIR / '</span>templates<span class="string">'], #两种方法</span></span><br></pre></td></tr></table></figure>
<p>templates创建在根目录下</p>
<p>方案1-通过 loader 获取模板,通过HttpResponse进行响应在视图函数中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_template</span><span class="params">(request)</span>:</span></span><br><span class="line">    t = loader.get_template(<span class="string">"index.html"</span>)<span class="comment">#引入模板</span></span><br><span class="line">    html = t.render()<span class="comment">#加载模板</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(html)</span><br></pre></td></tr></table></figure>
<p>方案2-使用render()直接加载并响应模板</p>
<p>在视图函数中:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_template</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>,字典)</span><br></pre></td></tr></table></figure>
<p>视图函数中可以将Python变量封装到字典中传递到模板</p>
<p>模板中,我们可以用的语法调用视图传进来的变量</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_template</span><span class="params">(request)</span>:</span></span><br><span class="line">    dic = &#123;</span><br><span class="line">        <span class="string">"uname"</span>:<span class="string">"I am Blosslom"</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>,dic)</span><br></pre></td></tr></table></figure>
<p>在html中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span>&#123;&#123;uname&#125;&#125;<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>能传入的种类</p>
<ul>
<li>str -字符串</li>
<li>int - 整型</li>
<li>list -数组</li>
<li>tuple -元组</li>
<li>dict - 字典</li>
<li>func -方法</li>
<li>obj -类实例化的对象</li>
</ul>
<p>在模板中使用变量语法</p>





<p>在views中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_value</span><span class="params">(request)</span>:</span></span><br><span class="line">    dic = &#123;&#125;</span><br><span class="line">    dic[<span class="string">'int'</span>] = <span class="number">88</span>  <span class="comment">#int型</span></span><br><span class="line">    dic[<span class="string">'str'</span>] = <span class="string">"xiaoming"</span>  <span class="comment">#字符串</span></span><br><span class="line">    dic[<span class="string">'list'</span>] = [<span class="string">'1'</span>, <span class="string">'3'</span>]  <span class="comment">#列表</span></span><br><span class="line">    dic[<span class="string">'dic'</span>] = &#123;<span class="string">"wang"</span>: <span class="string">'213'</span>, <span class="string">"ming"</span>: <span class="string">"123"</span>, &#125;  <span class="comment">#字典</span></span><br><span class="line">    dic[<span class="string">'func'</span>] = a_fun  <span class="comment">#方法，不要加括号否则使用返回值</span></span><br><span class="line">    dic[<span class="string">'class'</span>] = cls()  <span class="comment">#类</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"index.html"</span>, dic)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">a_fun</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"这是一个方法"</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">cls</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>在对应html中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; int &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">--这里的int不是指数据--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; str &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">--这里的str不是指字符串--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; list &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">--调用列表--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; list.1 &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">--调用列表第二个索引--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; dic.ming &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">--调用字典对应的键值--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; func &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">--调用函数--</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; class &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span> <span class="tag">&lt;<span class="name">--调用类--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="面向对象"><a class="markdownIt-Anchor" href="#面向对象"></a> 面向对象</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FangJan</span>:</span></span><br><span class="line">	Wupin = <span class="string">'zhuozi'</span> <span class="comment">#对象中的变量</span></span><br><span class="line">	difang = <span class="string">'beijing'</span></span><br><span class="line">	</span><br><span class="line">wod = FangJan() <span class="comment">#实例化一个对象</span></span><br><span class="line">wod.Wupin <span class="comment">#对象中的地址</span></span><br><span class="line">Nid = FangJan() <span class="comment">#实例化一个对象</span></span><br><span class="line">Nid.daxiao = <span class="string">'buda'</span> <span class="comment">#给实例化对象增加属性不影响wod这个实例化</span></span><br></pre></td></tr></table></figure>
<p>实例数据初始化</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FangJan</span>:</span></span><br><span class="line">	flag = <span class="string">"wd"</span> <span class="comment">#类的变量属性，可以在外面使用FangJan.flag=""修改</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span><span class="comment">#为实例进行数据初始化不可以在外面使用FangJan.flag=""修改</span></span><br><span class="line">		self.Wupin = <span class="string">""</span></span><br><span class="line">		self.difang = <span class="string">""</span></span><br></pre></td></tr></table></figure>
<p>传入参数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">human</span>:</span></span><br><span class="line">	where = <span class="string">""</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name)</span></span></span><br><span class="line">		self.w = "上"</span><br><span class="line">		self.s = <span class="string">"下"</span></span><br><span class="line">		self.a = <span class="string">"左"</span></span><br><span class="line">		self.d = <span class="string">"右"</span></span><br><span class="line">		self.name = <span class="string">"name"</span></span><br><span class="line">      </span><br><span class="line">   	 <span class="function"><span class="keyword">def</span> <span class="title">away</span><span class="params">(self,name)</span>#这个<span class="title">name</span>是上门的<span class="title">name</span></span></span><br><span class="line"><span class="function">         <span class="title">print</span><span class="params">(self.name)</span></span></span><br><span class="line">human.where = "地球"</span><br><span class="line"></span><br><span class="line">p1 = human(<span class="string">"ni"</span>)</span><br><span class="line">p2 = human(<span class="string">"wo"</span>)</span><br><span class="line">p1.away(<span class="string">''</span>)<span class="comment">#在使用的时候内容不能为空</span></span><br></pre></td></tr></table></figure>
<h2 id="模板标签"><a class="markdownIt-Anchor" href="#模板标签"></a> 模板标签</h2>
<h3 id="if标签"><a class="markdownIt-Anchor" href="#if标签"></a> if标签</h3>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;%if 条件表达式1 %&#125;</span><br><span class="line">...</span><br><span class="line">&#123;%elif 条件表达式1 %&#125;</span><br><span class="line">...</span><br><span class="line">&#123;%else%&#125;</span><br><span class="line">...</span><br><span class="line">&#123;%endif%&#125;<span class="tag">&lt;<span class="name">--没有结束标签肯定报错--</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>if 标签注意:</p>
<ol>
<li>if 条件表达式里可以用的运算符==,!=，&lt;, &gt;,&lt;=,&gt;=,in, not<br />
in, is,is not, not、and、or</li>
<li>在if标记中使用实际括号是无效的语法。如果您需要它们指示<br />
优先级，则应使用嵌套的if标记。</li>
</ol>
<h3 id="for标签"><a class="markdownIt-Anchor" href="#for标签"></a> for标签</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for 变量 in 可迭代对象 %&#125;</span><br><span class="line">	循环语句</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">	可迭代对象无数据时候填充</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#for" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#for</a></p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>forloop.counter</td>
<td>循环的当前迭代（从1开始索引）</td>
</tr>
<tr>
<td>forloop.counter0</td>
<td>循环的当前迭代（从0开始索引）</td>
</tr>
<tr>
<td>forloop.revcounter</td>
<td>counter值的倒序</td>
</tr>
<tr>
<td>forloop.revcounter0</td>
<td>revcounter值的倒序</td>
</tr>
<tr>
<td>forloop.first</td>
<td>如果这是第一次通过循环，则为真</td>
</tr>
<tr>
<td>forloop.last</td>
<td>如果这是最后一次循环，则为真</td>
</tr>
<tr>
<td>forloop.parentloop</td>
<td>当嵌套循环，parentloop表示外层循环</td>
</tr>
</tbody>
</table>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">for_test</span><span class="params">(request)</span>:</span></span><br><span class="line">    list_one = [<span class="string">"tom"</span>, <span class="string">"Bill"</span>, <span class="string">"Doum"</span>] <span class="comment">#第一个列表</span></span><br><span class="line">    list_two = [<span class="string">"aaa"</span>,<span class="string">"bbb"</span>,<span class="string">"ccc"</span>] <span class="comment">#第二个列表</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"test1.html"</span>, locals())</span><br></pre></td></tr></table></figure>
<p>在html中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">       &#123;% for i in list_one %&#125; <span class="tag">&lt;<span class="name">--遍历第一个--</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                &#123;&#123; i &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>no data<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line">        &#123;% for i in list_two %&#125;<span class="tag">&lt;<span class="name">--遍历第二个--</span>&gt;</span></span><br><span class="line">        &#123;% if forloop.first %&#125; <span class="tag">&lt;<span class="name">b</span>&gt;</span>first for<span class="tag">&lt;/<span class="name">b</span>&gt;</span> &#123;% endif %&#125; </span><br><span class="line">    <span class="tag">&lt;<span class="name">--首次循环执行的操作--</span>&gt;</span></span><br><span class="line">        &#123;% if forloop.last %&#125;<span class="tag">&lt;<span class="name">b</span>&gt;</span>last for<span class="tag">&lt;/<span class="name">b</span>&gt;</span> &#123;% endif %&#125; </span><br><span class="line">        <span class="tag">&lt;<span class="name">--最后循环执行的操作--</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">li</span>&gt;</span></span><br><span class="line">                &#123;&#123; forloop.counter &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">                &#123;&#123; i &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">    &#123;% empty %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">b</span>&gt;</span>no data<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    &#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在使用for循环，对字典中的数据进行操作时候，需要dic.键名</p>
<p>定义:在变量输出时对变量的值进行处理<br />
作用:可以通过使用过滤器来改变变量的输出显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">语法:&#123;&#123;变量|过滤器1:参数值1&#39;|过滤器2:参数值2&#39;…..&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>.</p>
<table>
<thead>
<tr>
<th>过滤器</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>lower</td>
<td>将字符串转换为全部小写</td>
</tr>
<tr>
<td>upper</td>
<td>将字符串转换为大写形式</td>
</tr>
<tr>
<td>safe</td>
<td>默认不对变量内的字符串进行html转义</td>
</tr>
<tr>
<td>add:“n”</td>
<td>将value的值增加n</td>
</tr>
<tr>
<td>truncatechars:“n”</td>
<td>如果字符串字符多于指定的字符数量，那么会被截断。截断的字符串将以可翻译的省略号序列(&quot;…&quot;)结尾。</td>
</tr>
</tbody>
</table>
<p>在html代码中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; int|add:"50" &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>this is &#123;&#123; str|upper &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>&#123;&#123; script|safe &#125;&#125;<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在python中传入和前端有关的代码会自动过滤掉敏感字符例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dic[<span class="string">'script'</span>] = <span class="string">"&lt;script&gt;alert('warning')&lt;/script&gt;"</span></span><br></pre></td></tr></table></figure>
<p>这个正常传入就不会被html执行，如果加上过滤器|safe表示这段代码是安全的，可以被执行。</p>
<h3 id="模板的继承"><a class="markdownIt-Anchor" href="#模板的继承"></a> 模板的继承</h3>
<p>模板继承可以使父模板的内容重用,子模板直接继承父模板的全部内容并可以覆盖父模板中相应的块</p>
<p>语法–父模板中:</p>
<ul>
<li>
<p>定义父模板中的块block标签</p>
</li>
<li>
<p>标识出哪些在子模块中是允许被修改的</p>
</li>
<li>
<p>block标签:在父模板中定义，可以在子模板中覆盖</p>
</li>
<li>
<p>语法–子模板中:<br />
继承模板extends标签(写在模板文件的第一行)<br />
例如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#39;base.html&#39; %&#125;</span><br></pre></td></tr></table></figure>
</li>
<li>
<p>子模板重写父模板中的内容块</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% block block_name %&#125;</span><br></pre></td></tr></table></figure>
<p>子模板块用来覆盖父模板中 block_name块的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% endblock block_name %&#125;</span><br></pre></td></tr></table></figure>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main_page</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"main.html"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">son1</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"son1.html"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">son2</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"son2.html"</span>)</span><br></pre></td></tr></table></figure>
<p>上面定义了三个文件的视图返回模板</p>
<p>在html文件中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    &#123;% block title %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="tag">&lt;<span class="name">--被block标记的是能够在子模板被改变的内容--</span>&gt;</span></span><br><span class="line">    &#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/son1"</span>&gt;</span>进入son1<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">--链接到子页面，注意这里链接的是路由里面的路径--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/son2"</span>&gt;</span>进入son2<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"></span><br><span class="line">&#123;% block tail %&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span>这是主页面的东西<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>son1</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "main.html" %&#125; <span class="tag">&lt;<span class="name">--开头继承主视图文件--</span>&gt;</span></span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>son1<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="tag">&lt;<span class="name">--使用定义的block更改需要改的内容--</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block tail %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>这是son1<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>son2</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends "main.html" %&#125; <span class="tag">&lt;<span class="name">--开头继承主视图文件--</span>&gt;</span></span><br><span class="line">&#123;% block title %&#125;</span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>son2<span class="tag">&lt;/<span class="name">title</span>&gt;</span> <span class="tag">&lt;<span class="name">--使用定义的block更改需要改的内容--</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line">&#123;% block tail %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>这是son1<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>
<p>重写的覆盖规则</p>
<ul>
<li>不重写,将按照父模板的效果显示</li>
<li>重写,则按照重写效果显示</li>
</ul>
<p>注意</p>
<ul>
<li>模板继承时,服务器端的动态内容无法继承</li>
</ul>
<h3 id="静态资源标签"><a class="markdownIt-Anchor" href="#静态资源标签"></a> 静态资源标签</h3>
<p>模板中访问静态文件– img标签为例方案2</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">通过&#123;% static %&#125;标签访问静态文件</span><br><span class="line">1.加载static - &#123;% load static %&#125;</span><br><span class="line">2.使用静态资源– &#123;% static &#39;静态资源路径&#39; %&#125;</span><br></pre></td></tr></table></figure>
<p>3.样例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load static %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">"% static 'images/lena.jpg'%&#125;"</span></span></span><br></pre></td></tr></table></figure>
<h2 id="url反向解析"><a class="markdownIt-Anchor" href="#url反向解析"></a> URL反向解析</h2>
<p>1，绝对地址</p>
<p>整个路径（协议+IP：port+路径）</p>
<p>2，相对地址</p>
<p>/path/1，带/开头的为（协议+IP：port+/path/1）</p>
<p>path/1，没有/开头的（当前最后一个/前的URL+path/1）</p>
<p>url反向解析是指在视图或模板中，用path定义的名称来动态查找或计算出相应的路由<br />
path函数的语法</p>
<ul>
<li>path(route, views,name=“别名”)</li>
<li>path(‘page’, views.page_view, name=“page_url”)</li>
</ul>
<p>根据path中的<code>name=</code>关键字传参给url确定了个唯一确定的名字，在模板或视图中，可以通过这个名字反向推断出此url信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在模板中使用&#123;% url &quot;反向的name&quot; &quot;path转换器的名字&quot;%&#125;</span><br></pre></td></tr></table></figure>
<p>在url文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'son2'</span>, views.son2,name=<span class="string">'url2'</span>),</span><br><span class="line">path(<span class="string">'url/reverse/&lt;int:num&gt;'</span>,views.url_reverse,name=<span class="string">"url1"</span>) <span class="comment">#使用了path转换器参数名为num</span></span><br></pre></td></tr></table></figure>
<p>定义的这两个name表示在全部文件中都可以使用</p>
<p>在html文件中使用</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"&#123;% url "</span><span class="attr">url1</span>" "<span class="attr">100</span>"%&#125;"&gt;</span>一个url地址<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">--传入的url1的路径,后面的100是传入num的参数--</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在视图文件中使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> reverse</span><br><span class="line">reverse(<span class="string">'name名'</span>,args=[],kwargs=&#123;&#125;) <span class="comment">#获得反向解析的url，args是参数kwargs是参数组</span></span><br></pre></td></tr></table></figure>
<h2 id="静态文件配置"><a class="markdownIt-Anchor" href="#静态文件配置"></a> 静态文件配置</h2>
<p>用于存放css，js文件和font文件，image图像</p>
<p>静态文件配置- settings.py中<br />
1，配置静态文件的访问路径【该配置默认存在】</p>
<ul>
<li>通过哪个url地址找静态文件</li>
<li>STATIC_URL = ‘/static/’</li>
<li>说明:</li>
<li>指定访问静态文件时是需要通过/static/xxx或http://127.0.0.1:8000/static/xxx<br />
[xxx表示具体的静态资源位置]</li>
</ul>
<p>再setting文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">STATIC_URL = <span class="string">'/static/'</span> <span class="comment">#静态资源请求的url</span></span><br><span class="line">STATICFILES_DIRS = [</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">'static'</span>) <span class="comment">#当前路径下的static文件夹</span></span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">'static'</span>).replace(<span class="string">'\\'</span>, <span class="string">'/'</span>), <span class="comment">#解决windows开发环境路径问题</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>还可以添加其他路径</p>
<h2 id="应用"><a class="markdownIt-Anchor" href="#应用"></a> 应用</h2>
<p>应用的概念再django中，是为了分开为多个MTV进行管理每个板块应用中有单独的路由，视图，模板，模型。应用之间的代码相互隔离。</p>
<p>创建应用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py startapp 应用名</span><br></pre></td></tr></table></figure>
<p>注册应用在setting中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">"应用名"</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>删除应用，先删除应用中的models.py再删除整个目录树，取消setting中的注册</p>
<h3 id="分布式路由"><a class="markdownIt-Anchor" href="#分布式路由"></a> 分布式路由</h3>
<p>Django中,由路由配置文件(<a href="http://url.py" target="_blank" rel="noopener">url.py</a>)不进行处理用户具体路由的请求，路由配置文件的可以做请求的分发(分布式请求处理)。具体的请求可以由各自的应用的url.py来进行处理</p>
<p>步骤1–主路由中调用include函数</p>
<p>语法:include(‘app名字.url模块名’)<br />
作用:用于将当前路由转到各个应用的路由配置文件的urlpatterns进行分布式处理</p>
<p>步骤2–应用下配置urls.py应用下手动创建urls.py文件内容结构向全路由完全一样</p>
<p>在主路由url中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path, include</span><br><span class="line">urlpatterns = [</span><br><span class="line">    <span class="comment"># myapp</span></span><br><span class="line">    path(<span class="string">'myapp/'</span>, include(<span class="string">"myapp.urls"</span>)), <span class="comment">#匹配到myapp路径交给app的路由处理/放到主路由下</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p><a href="http://xn--appurls-i43k750ak7mm3uwu0jjxpb.py" target="_blank" rel="noopener">在app中需要创建urls.py</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> . <span class="keyword">import</span> views <span class="comment">#引入的是当前app的views</span></span><br><span class="line"></span><br><span class="line">urlpatterns=[ <span class="comment">#名字不能拼错</span></span><br><span class="line">    path(<span class="string">'index'</span>, views.index) <span class="comment">#接着主路由传来的路径匹配index	</span></span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>应用内部可以配置模板目录<br />
1.应用下手动创建templates文件夹</p>
<p>2.settings.py中开启应用模板功能<br />
TEMPLATE配置项中的’APP_DIRS’值为True即可</p>
<p>应用下templates和外层templates都存在时,django得查找模板规则</p>
<ul>
<li>1.优先查找外层templates目录下的模板</li>
<li>2.按INSTALLED_APPS配置下的应用顺序逐层查找</li>
</ul>
<p>命名模板最好app_***.html或者在app目录的templates下面再添加一个和app同名的文件夹然后把html移入。</p>
<p>在views中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> ***<span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">"app/***.html"</span>)</span><br></pre></td></tr></table></figure>
<h2 id="orm"><a class="markdownIt-Anchor" href="#orm"></a> ORM</h2>
<h3 id="windows系统数据库部署"><a class="markdownIt-Anchor" href="#windows系统数据库部署"></a> windows系统数据库部署</h3>
<p><a href="https://www.cnblogs.com/zhangkanghui/p/9613844.html" target="_blank" rel="noopener">https://www.cnblogs.com/zhangkanghui/p/9613844.html</a></p>
<p>在windows系统下安装数据库<strong><a href="http://mirrors.sohu.com/mysql/MySQL-8.0/" target="_blank" rel="noopener">http://mirrors.sohu.com/mysql/MySQL-8.0/</a></strong></p>
<p>下载好解压后放入python目录</p>
<p>配置环境变量</p>
<p>进入变量配置界面在path中加入路径</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E:\Python\mysql-8.0.26-winx64\bin</span><br></pre></td></tr></table></figure>
<p>使用管理员打开cmd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld --initialize-insecure --user&#x3D;mysql</span><br></pre></td></tr></table></figure>
<p>在E:\python\mysql\mysql-8.0.12-winx64目录下生成data目录</p>
<p>安装mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld -install</span><br></pre></td></tr></table></figure>
<p>启动mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start MySQL</span><br></pre></td></tr></table></figure>
<p>登录mysql</p>
<p><strong>登录MySQL</strong></p>
<p>登录mysql:(因为之前没设置密码，所以密码为空，不用输入密码，直接回车即可）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure>
<p>查询密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">select host,user,authentication_string from mysql.user;</span><br><span class="line">use mysql</span><br><span class="line">ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</span><br><span class="line">flush privileges; </span><br><span class="line">quit</span><br></pre></td></tr></table></figure>
<h3 id="linux系统"><a class="markdownIt-Anchor" href="#linux系统"></a> Linux系统</h3>
<p>安装mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt install mysql-server</span><br></pre></td></tr></table></figure>
<p>具体mysql查询命令查看https://www.runoob.com/mysql/mysql-create-database.html</p>
<p>配置mysql</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip install mysqlclient</span><br><span class="line">pip install Pillow</span><br></pre></td></tr></table></figure>
<p>在ubuntu中需要libmysqlclient-dev和python3-dev</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt list --installed|grep -E 'libmysqlclient-dev|python3-dev' #判断是否有依赖包</span><br><span class="line">apt install python3-dev default-libmysqlclient-dev #没有则安装</span><br></pre></td></tr></table></figure>
<p>创建数据库</p>
<p>ORM：</p>
<ul>
<li>类=数据表</li>
<li>对象=数据行</li>
<li>属性=字段</li>
</ul>
<p>进入mysql数据库执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database 数据库名 default charset utf8</span><br></pre></td></tr></table></figure>
<p>通常数据库名跟项目名保持一致<br />
settings.py里进行数据库的配置<br />
修改DATABASES配置项的内容，由sqlite3变为mysql</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>,</span><br><span class="line">        <span class="string">'NAME'</span>: <span class="string">'mysite'</span>,</span><br><span class="line">        <span class="string">'USER'</span>: <span class="string">'root'</span>,</span><br><span class="line">        <span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line">        <span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">        <span class="string">'PORT'</span>: <span class="string">'3306'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义: ORM (Object Relational Mapping)即对象关系映射，是一种程序技术，它允许你使用类和对象对数据库进行操作,人避免通过SQL语句操作数据库<br />
作用:</p>
<ul>
<li>1.建立模型类和表之间的对应关系,允许我们通过面向对象的方式来操作数据库。</li>
<li>2.根据设计的模型类生成数据库中的表格。</li>
<li>3.通过简单的配置就可以进行数据库的切换。</li>
</ul>
<p>优点:</p>
<ul>
<li>
<p>只需要面向对象编程，不需要面向数据库编写代码。</p>
</li>
<li>
<p>对数据库的操作都转化成对类属性和方法的操作。</p>
</li>
<li>
<p>不用编写各种数据库的sql语句</p>
</li>
<li>
<p>实现了数据模型与数据库的解耦,屏蔽了不同数据库操作上的差异。</p>
</li>
<li>
<p>不在关注用的是mysql、oracle…等数据库的内部细节。</p>
</li>
<li>
<p>通过简单的配置就可以轻松更换数据库,而不需要修改代码</p>
</li>
</ul>
<h3 id="编写model"><a class="markdownIt-Anchor" href="#编写model"></a> 编写model</h3>
<h4 id="数据库迁移"><a class="markdownIt-Anchor" href="#数据库迁移"></a> 数据库迁移</h4>
<p>迁移是Diango同步您对模型所做更改（添加字段，删除模型等）到您的数据库模式的方式</p>
<p>生成迁移文件–执行python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> makemigrations将应用下的models.py文件生成一个中间文件,并保存在migrations文件夹中</p>
<p>执行迁移脚本程序–执行python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> migrate执行迁移程序实现迁移。将每个应用下的migrations目录中的中间文件同步回数据库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure>
<p>在迁移数据库的时候，如果出现问题删除，migrations中除了__init__.py的内容全部删除，再删除models文件中对应的拆创建的表，再删除数据库中django_session对应的记录数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">databases</span> *</span><br><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> *</span><br><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> 表名 <span class="keyword">where</span> 列=数据名</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> 表名 <span class="keyword">drop</span> <span class="keyword">column</span> 列名</span><br><span class="line"><span class="keyword">update</span> tablename <span class="keyword">set</span> colname=<span class="string">'xx'</span> <span class="keyword">where</span> <span class="keyword">id</span>=<span class="number">1</span>; //更改某个字段中个别数据tablename ：表名，colname：字段名</span><br><span class="line">mysqldump -uroot -p abc &gt; abc.sql //备份数据库</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> abc <span class="keyword">default</span> <span class="keyword">charset</span> utf8;      <span class="comment"># 创建数据库</span></span><br><span class="line"><span class="keyword">use</span> abc;                  <span class="comment"># 使用已创建的数据库 </span></span><br><span class="line">source /home/abc/abc.sql  <span class="comment"># 导入备份数据库</span></span><br></pre></td></tr></table></figure>
<p>在app文件的models文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(verbose_name=<span class="string">'书名'</span>, max_length=<span class="number">100</span>, default=<span class="string">''</span>) <span class="comment">#verbose_name可以不用写,字符，书名会出现在数据库中</span></span><br><span class="line">    price = models.DecimalField(<span class="string">'价格'</span>, max_digits=<span class="number">8</span>, decimal_places=<span class="number">2</span>, default=<span class="string">''</span>) <span class="comment">#适用于金钱，digits表示位数，decimal_palces表示小数点位数000000.00</span></span><br></pre></td></tr></table></figure>
<p>defualt表示默认值，字段存入的时候不知道则走默认值</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>数据库对应名字</th>
<th>注意</th>
</tr>
</thead>
<tbody>
<tr>
<td>models.BooleanField()</td>
<td>tinyint(1)</td>
<td>编程中使用的是True或False数据库中对应的01</td>
</tr>
<tr>
<td>models.CharField()</td>
<td>varchar</td>
<td>必须指定max_length参数</td>
</tr>
<tr>
<td>models.DateField()</td>
<td>date</td>
<td>auto_now:每次保存对象时，自动设置该字段为当前时间(取值:True/False)。auto_now_add:当对象第一次被创建时自动设置当前时间(取值:True/False)。default:设置当前时间(取值:字符串格式时间如: ‘2019-6-1’)。以上三个参数只能多选一</td>
</tr>
<tr>
<td>models.DateTimeField()</td>
<td>datetime(6)</td>
<td>表示日期和时间，参数同DateField</td>
</tr>
<tr>
<td>models.FloatField()</td>
<td>double</td>
<td>都是用小数表示</td>
</tr>
<tr>
<td>models.DecimalField()</td>
<td>decimal(x,y)</td>
<td>max_digits,decimal_places</td>
</tr>
<tr>
<td>models.EmailField()</td>
<td>varcahr</td>
<td>都是字符串</td>
</tr>
<tr>
<td>models.intergerField()</td>
<td>int</td>
<td>都是使用整数</td>
</tr>
<tr>
<td>models.imageField()</td>
<td>varchar(100)</td>
<td>都使用字符串</td>
</tr>
<tr>
<td>models.TextField()</td>
<td>longtext</td>
<td>标识不定长的字符数据</td>
</tr>
</tbody>
</table>
<h3 id="字段选项"><a class="markdownIt-Anchor" href="#字段选项"></a> 字段选项</h3>
<p>字段选项,指定创建的列的额外的信息<br />
允许出现多个字段选项,多个选项之间使用,隔开</p>
<ul>
<li>primary_key<br />
如果设置为True,表示该列为主键,如果指定一个字段为主键，则此数库表不会创建id字段</li>
<li>blank<br />
设置为True时，字段可以为空。设置为False时，字段是必须填写</li>
<li>null<br />
如果设置为True,表示该列值允许为空。<br />
默认为False,如果此选项为False建议加入default选项来设置默认值</li>
<li>default<br />
设置所在列的默认值,如果字段选项null=False建议添加此项</li>
<li>unique=Ture唯一</li>
</ul>
<p>null和default二选一</p>
<ul>
<li>db_index<br />
如果设置为True,表示为该列增加索引unique<br />
如果设置为True,表示该字段在数据库中的值必须是唯一(不能重复出现的)</li>
<li>db_column<br />
指定列的名称,如果不指定的话则采用属性名作为列名</li>
<li>verbose_name<br />
设置此字段在admin界面上的显示名</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">title = models.CharField(<span class="string">'书名'</span>, max_length=<span class="number">100</span>, default=<span class="string">''</span>,unique=<span class="literal">True</span>,null=<span class="literal">True</span>)<span class="comment">#default默认值意思是如果不输入默认为多少，unique表示唯一不能重复，null可以允许为空。</span></span><br></pre></td></tr></table></figure>
<p>整形的字段限制</p>
<p>validators=[最小，最大]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="keyword">from</span> django.core.validators <span class="keyword">import</span> MinValueValidator, MaxValueValidator</span><br><span class="line"></span><br><span class="line">size = models.IntegerField(<span class="string">u'尺寸大小'</span>, validators=[</span><br><span class="line">    MinValueValidator(<span class="number">1</span>),</span><br><span class="line">    MaxValueValidator(<span class="number">42</span>)</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<h3 id="meta类"><a class="markdownIt-Anchor" href="#meta类"></a> Meta类</h3>
<p>使用内部 Meta类来给模型赋予属性，Meta类下有很多内建的类属性，可对模型类做一些控制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    title = models.CharField(<span class="string">'书名'</span>, max_length=<span class="number">100</span>, default=<span class="string">''</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"book"</span></span><br><span class="line">        verbose_name = <span class="string">"书"</span><span class="comment">#用于管理后台显示默认带s</span></span><br><span class="line">        verbose_name_plural = <span class="string">"书"</span><span class="comment">#用于管理后台显示不带s</span></span><br></pre></td></tr></table></figure>
<h3 id="文件记录"><a class="markdownIt-Anchor" href="#文件记录"></a> 文件记录</h3>
<p>文件记录在了mysql中的django_migrations字段</p>
<h3 id="管理器对象"><a class="markdownIt-Anchor" href="#管理器对象"></a> 管理器对象</h3>
<p>每个继承自models.Model的模型类，都会有一个objects对象被同样继承下来。这个对象叫管理器对象</p>
<h4 id="创建数据方法"><a class="markdownIt-Anchor" href="#创建数据方法"></a> 创建数据方法</h4>
<p>方法一：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b1 = book.objects.create(title=<span class="string">'python'</span>,price=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<p>方法二：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b1 = Book(title=<span class="string">"python"</span>,price=<span class="number">50</span>)</span><br><span class="line">b1.save()</span><br></pre></td></tr></table></figure>
<h3 id="django-shell"><a class="markdownIt-Anchor" href="#django-shell"></a> Django Shell</h3>
<p>在Django提供了一个交互式的操作项目叫<br />
Django Shell它能够在<br />
交互模式用项目工程的代码执行相应的操作<br />
利用Django Shell可以代替编写view的代码来进行直接操作注意:项目代码发生变化时,重新进入Django shell</p>
<p>在交互模式中传入数据需要导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> app.models improt book</span><br></pre></td></tr></table></figure>
<h3 id="orm查询"><a class="markdownIt-Anchor" href="#orm查询"></a> ORM查询</h3>
<p>数据库的查询需要使用管理器对象进行<br />
通过MyModel.objects管理器方法调用查询方法</p>
<p>all()方法</p>
<ul>
<li>用法: MyModel.objects.all()</li>
<li>作用:查询MyModel实体中所有的数据等同于select * from tabel</li>
<li>返回值: QuerySet容器对象,内部存放MyModel 实例</li>
</ul>
<p>values(“列1”，“列2”)</p>
<ul>
<li>用法:MyModel.objects.values(…)</li>
<li>查询部分列返回元组数据，等同于select 列1，列2 from ***</li>
</ul>
<p>values_list(“列1”，“列2”)</p>
<ul>
<li>用法:MyModel.objects.values_list(…)</li>
<li>返回元组形式的查询结果，等同于select 列1，列2 from ***</li>
</ul>
<p>order_by()</p>
<ul>
<li>用法:MyModel.objects.order_by(&quot;-列&quot;，“列”)</li>
<li>作用：与all()方法不同，它会用SQL语句的ORDER BY子句对查询结果进行根据某个字段选择性的进行排序，-表示降序</li>
</ul>
<p>使用django shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> book.models <span class="keyword">import</span> book <span class="comment">#导入book表单</span></span><br><span class="line">b1 = Book.objects.all() <span class="comment">#select * from book展示表单</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b1: <span class="comment">#遍历表单</span></span><br><span class="line">	print(book.title) <span class="comment">#打印表单的title列</span></span><br></pre></td></tr></table></figure>
<p>如果不想循环遍历打印，在models文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">book</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span> <span class="comment">#定义取数据字段</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">&#123;self.title&#125;</span>//<span class="subst">&#123;self.price&#125;</span>"</span></span><br></pre></td></tr></table></figure>
<p>组合查询方法：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b1 = Book.bojects.all().order_by()</span><br></pre></td></tr></table></figure>
<p>对应sql语句查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(b1.query)</span><br></pre></td></tr></table></figure>
<p>在视图中接入数据库通过导入，在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> 类名</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">all_book</span><span class="params">(request)</span>:</span></span><br><span class="line">	all_book = Book.objects.all()</span><br><span class="line">	<span class="keyword">return</span> render(request,<span class="string">'.html'</span>,locals())</span><br></pre></td></tr></table></figure>
<p>在模板中</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">&#123;% for i in all_book %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>i.title<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">b</span>&gt;</span>i.price<span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">&#123;% emptyfor %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="条件查询"><a class="markdownIt-Anchor" href="#条件查询"></a> 条件查询</h4>
<h5 id="filter"><a class="markdownIt-Anchor" href="#filter"></a> filter()</h5>
<ul>
<li>语法: MyModel.objects.filter(属性1=值1，属性2=值2)</li>
<li>作用:返回包含此条件的全部的数据集</li>
<li>返回值:QuerySet容器对象,内部存放MyModel实例</li>
<li>说明:当多个属性在一起时为&quot;与&quot;关系</li>
</ul>
<p>在视图文件下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> book</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">book_info</span><span class="params">(request)</span>:</span></span><br><span class="line">	book_name = book.objects.filter(title=<span class="string">"清华大学出版社"</span>) <span class="comment">#title是类里面的一个属性</span></span><br></pre></td></tr></table></figure>
<h5 id="exclude"><a class="markdownIt-Anchor" href="#exclude"></a> exclude()</h5>
<ul>
<li>语法：MyModel.objects.exclude(属性1=值1，属性2=值2)</li>
<li>作用：返回不包含此条件的全部数据</li>
</ul>
<h5 id="get"><a class="markdownIt-Anchor" href="#get"></a> get()</h5>
<ul>
<li>
<h4 id="语法mymodelobjectsget属性1值1属性2值2"><a class="markdownIt-Anchor" href="#语法mymodelobjectsget属性1值1属性2值2"></a> 语法:MyModel.objects.get(属性1=值1，属性2=值2)</h4>
</li>
<li>
<p>作用:返回满足条件的唯——条数据</p>
</li>
<li>
<p>说明:该方法只能返回一条数据</p>
</li>
<li>
<p>查询结果多余一条数据则抛出出,Model.MultipleObjectsReturned异常</p>
</li>
<li>
<p>查询结果如果没有数据则抛出Model.DoesNotExist异常</p>
</li>
</ul>
<p>注意get和filter获取的数据类型不一样</p>
<h4 id="查询谓语词"><a class="markdownIt-Anchor" href="#查询谓语词"></a> 查询谓语词</h4>
<ul>
<li>定义:做更灵活的条件查询时需要使用查询谓词</li>
<li>说明:每一个查询谓词是一个独立的查询功能</li>
</ul>
<h5 id="__exact"><a class="markdownIt-Anchor" href="#__exact"></a> __exact</h5>
<p>等值匹配</p>
<p>用法：字段__exact，常用于查询为NULL的数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.create.filter(id__exact&#x3D;1)</span><br></pre></td></tr></table></figure>
<h5 id="__contains"><a class="markdownIt-Anchor" href="#__contains"></a> __contains</h5>
<p>包含指定值</p>
<p>用法：字段__contains</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.create.filter(id__contains&#x3D;&quot;1&quot;)#查询字段包含1的数据select * from book name like &quot;%w%&quot;</span><br></pre></td></tr></table></figure>
<h5 id="__startswith"><a class="markdownIt-Anchor" href="#__startswith"></a> __startswith</h5>
<p>以什么为开头</p>
<h5 id="__endswith"><a class="markdownIt-Anchor" href="#__endswith"></a> __endswith</h5>
<p>以什么为结束</p>
<h5 id="__gt"><a class="markdownIt-Anchor" href="#__gt"></a> __gt</h5>
<p>大于多少的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.filter(book__gt=<span class="number">50</span>)</span><br></pre></td></tr></table></figure>
<h5 id="__gte"><a class="markdownIt-Anchor" href="#__gte"></a> __gte</h5>
<p>大于等于</p>
<h5 id="__lt"><a class="markdownIt-Anchor" href="#__lt"></a> __lt</h5>
<p>小于</p>
<h5 id="__lte"><a class="markdownIt-Anchor" href="#__lte"></a> __lte</h5>
<p>小于等于</p>
<h5 id="__in"><a class="markdownIt-Anchor" href="#__in"></a> __in</h5>
<p>查找数据是否在指定范围内</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.filter(book__in=[<span class="string">'python'</span>,<span class="string">'C'</span>])</span><br></pre></td></tr></table></figure>
<h5 id="__range"><a class="markdownIt-Anchor" href="#__range"></a> __range</h5>
<p>查找数据是否在指定区间范围内</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.filter(book__page=(<span class="number">300</span>,<span class="number">400</span>))</span><br></pre></td></tr></table></figure>
<h4 id="增删操作"><a class="markdownIt-Anchor" href="#增删操作"></a> 增删操作</h4>
<p>获取数据，修改保存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">b = book.objects.get(id = <span class="number">1</span>)</span><br><span class="line">b.name = name</span><br><span class="line">b.save() <span class="comment">#保存数据针对单个数据如果是一个数据组使用b.update(name = name)</span></span><br></pre></td></tr></table></figure>
<p>获取数据，删除数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b &#x3D; book.objects.get(id &#x3D; 1)</span><br><span class="line">b.delete()</span><br></pre></td></tr></table></figure>
<h3 id="伪删除"><a class="markdownIt-Anchor" href="#伪删除"></a> 伪删除</h3>
<p>通常不会轻易在业务里把数据真正删掉，取而代之的是做伪删除，即在表中添加一个布尔型字段(is_active),默认是True;执行删除时，将欲删除数据的is_active字段置为False<br />
注意:用伪删除时，确保显示数据的地方，均加了is_active=True的过滤查询。</p>
<h3 id="f和q对象"><a class="markdownIt-Anchor" href="#f和q对象"></a> F和Q对象</h3>
<h4 id="f对象"><a class="markdownIt-Anchor" href="#f对象"></a> F对象</h4>
<p>用于同时并发处理相同的一个数值，解决资源竞争</p>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> F</span><br><span class="line">book = book.objects.get(id=id)</span><br><span class="line"><span class="comment">#F对象</span></span><br><span class="line">book.mun = F(<span class="string">'num'</span>)<span class="number">-1</span> <span class="comment">#表示标记数量减1</span></span><br><span class="line">book.save()</span><br><span class="line"><span class="comment">#等同于sql语句 update book set num = num - 1 where id=id</span></span><br><span class="line"><span class="comment">#sql语句有互斥锁，只能由一个人操作</span></span><br></pre></td></tr></table></figure>
<p>具体用法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">book.objects.filter(sale_price__gt=F(<span class="string">'get_price'</span>))<span class="comment">#表示过滤当前售卖价格大于自身获取价格的书</span></span><br></pre></td></tr></table></figure>
<h4 id="q对象"><a class="markdownIt-Anchor" href="#q对象"></a> Q对象</h4>
<p>当在获取查询结果集使用复杂的逻辑或|逻辑非～等操作时可以借助于Q对象进行操作</p>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.modles <span class="keyword">import</span> Q</span><br><span class="line">Q(条件<span class="number">1</span>)|Q(条件<span class="number">2</span>) <span class="comment">#条件1成立或条件2成立</span></span><br><span class="line">Q(条件<span class="number">1</span>)&amp;Q(条件<span class="number">2</span>) <span class="comment">#条件1成立和条件2同时成立</span></span><br><span class="line">Q(条件<span class="number">1</span>)&amp;~Q(条件<span class="number">2</span>) <span class="comment">#条件1成立且条件2不成立</span></span><br><span class="line">book.objects.filter(Q(price__gt=<span class="number">50</span>)|Q(title=<span class="string">"python"</span>))</span><br></pre></td></tr></table></figure>
<h3 id="聚合查询"><a class="markdownIt-Anchor" href="#聚合查询"></a> 聚合查询</h3>
<p>聚合查询是指对一个数据表中的一个字段的数据进行部分或全部进行统计查询,查bookstore_book数据表中的全部书的平均价格，查询所有书的总个数等,都要使用聚合查询 。</p>
<p>在视图文件中</p>
<p>聚合函数：Sum求和，Avg求平均值，Count统计数量，Max最大值，Min最小值</p>
<h4 id="整表聚合"><a class="markdownIt-Anchor" href="#整表聚合"></a> 整表聚合</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db.models <span class="keyword">import</span> *</span><br><span class="line">MyModel.objects.aggregate(num=聚合函数(<span class="string">"列"</span>))<span class="comment">#再SQL中select count(列) as num from music将统计后的值以num命名，以某个列名来进行聚合</span></span><br><span class="line">&gt;&gt;&gt;&#123;结果变量名:值&#125; <span class="comment">#返回字典</span></span><br></pre></td></tr></table></figure>
<h4 id="分组聚合"><a class="markdownIt-Anchor" href="#分组聚合"></a> 分组聚合</h4>
<p>分组聚合是指通过计算查询结果中每一个对象所关联的对象集合，从而得出总计值(也可以是平均值或总和)，即为查询集的每一项生成聚合。<br />
语法:</p>
<ul>
<li>QuerySet.annotate(结果变量名=聚合函数(列’))返回值:</li>
<li>QuerySet</li>
</ul>
<p>先分组，再聚合</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">b &#x3D; Book.objects.values(&quot;price&quot;).annotate(num&#x3D;Count(&#39;id&#39;))#以price为分组，对id进行统计，意思是price一样的为一个字典</span><br><span class="line">&gt;&gt;&gt;返回一个包含很多字典的QuerySet</span><br></pre></td></tr></table></figure>
<h3 id="原生数据库操作"><a class="markdownIt-Anchor" href="#原生数据库操作"></a> 原生数据库操作</h3>
<p>Django也可以支持直接用sql语句的方式通信数据库</p>
<p>查询:使用MyModel.objects.raw()进行数据库查询操作查询</p>
<p>语法: MyModel.objects.raw(sql语句,拼接参数)</p>
<p>返回值：RawQuerySet集合对象</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = book.objects.raw(<span class="string">"select * from book where id=%s,['1 or 1=1']"</span>)</span><br></pre></td></tr></table></figure>
<p>使用拼接，可以解决注入问题</p>
<h4 id="cursor"><a class="markdownIt-Anchor" href="#cursor"></a> cursor</h4>
<p>完全跨过模型类操作数据库–查询/更新/删除<br />
1.导入cursor所在的包<br />
from django.db import connection</p>
<p>⒉.用创建cursor类的构造函数创建cursor对象,再使用cursor对象,为保证在出现异常时能释放cursor资源,通常使用with语句进行创建操作</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from django.db import connection</span><br><span class="line">with connection.cursor() as cur:</span><br><span class="line">	cur.execute(&#39;SQL语句&#39;,&#39;拼接参数&#39;)</span><br></pre></td></tr></table></figure>
<h3 id="内容修改"><a class="markdownIt-Anchor" href="#内容修改"></a> 内容修改</h3>
<h4 id="音乐名管理系统"><a class="markdownIt-Anchor" href="#音乐名管理系统"></a> 音乐名管理系统</h4>
<p>路由，使用的app子url</p>
<p>在主路由中配置如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path(<span class="string">'music/'</span>, include(<span class="string">'music.urls'</span>)),</span><br></pre></td></tr></table></figure>
<p>在子路由urls文件配置如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'index'</span>, views.index), <span class="comment">#展示页面</span></span><br><span class="line">    path(<span class="string">'replace/&lt;int:id&gt;'</span>, views.replace), <span class="comment">#进入修改页面，id是通过数据库获取，然后经过视图文件传入到模板在定向到这里的。</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在模型文件中：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Music</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(max_length=<span class="number">50</span>, default=<span class="string">""</span>)</span><br><span class="line">    time = models.CharField(max_length=<span class="number">5</span>, default=<span class="string">"00:00"</span>)</span><br><span class="line">    id = models.IntegerField(max_length=<span class="number">5</span>,primary_key=<span class="literal">True</span>)</span><br><span class="line">    auto_name = models.CharField(max_length=<span class="number">50</span>,default=<span class="string">"NO"</span>)</span><br><span class="line">    is_active = models.BooleanField(<span class="string">"是否活跃"</span>, default=<span class="literal">True</span>)</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"music"</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">f"<span class="subst">&#123;self.name&#125;</span>//<span class="subst">&#123;self.time&#125;</span>"</span></span><br></pre></td></tr></table></figure>
<p>定义四个数据类型，id设置为了主键</p>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request,)</span>:</span> <span class="comment">#展示页面</span></span><br><span class="line">    music_info = Music.objects.filter(is_active=<span class="literal">True</span>)<span class="comment">#过滤掉删除的数据</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">"music/index.html"</span>, locals()) <span class="comment">#需要传入数据以供获取id</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">replace</span><span class="params">(request, id)</span>:</span></span><br><span class="line">    <span class="comment"># 查</span></span><br><span class="line">    <span class="keyword">try</span>: <span class="comment">#检测是否有id传入</span></span><br><span class="line">        m = Music.objects.get(id=id，is_active=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e: <span class="comment">#没有id传入则进行弹出报错页面防止用户乱输入url</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'you are input no result'</span>)</span><br><span class="line">    <span class="comment"># 改</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'get'</span>: <span class="comment">#如过方法为get，则通过传入数据正常进入更新页面</span></span><br><span class="line">        <span class="keyword">return</span> render(request, <span class="string">'music/replace.html'</span>,locals())</span><br><span class="line">    <span class="keyword">elif</span> request.method == <span class="string">'post'</span>: <span class="comment">#如果为post方法进入修改</span></span><br><span class="line">        time = request.POST[<span class="string">'time'</span>] <span class="comment">#获取post页面提交的数据</span></span><br><span class="line">        auto_name = request.POST[<span class="string">'auto_name'</span>] </span><br><span class="line">        <span class="comment"># 改</span></span><br><span class="line">        m.time = time <span class="comment">#对应的数据</span></span><br><span class="line">        m.auto_name = auto_name</span><br><span class="line">        <span class="comment"># 保存</span></span><br><span class="line">        m.save() </span><br><span class="line">        <span class="keyword">return</span> HttpResponseRedirect(<span class="string">"/music/index"</span>) <span class="comment">#重定向到展示页面</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(request)</span>:</span></span><br><span class="line">    music_id = request.GET.get(<span class="string">'music_id'</span>) <span class="comment">#获取需要删除的id</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> music_id:  <span class="comment">#判断id是否为空</span></span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"your input error"</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        m = Music.objects.get(id=music_id, is_active=<span class="literal">True</span>) <span class="comment">#检测是否有id传入属于数据库内的</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">"your input error"</span>)</span><br><span class="line">    m.is_active = <span class="literal">False</span>  <span class="comment">#进行伪删除</span></span><br><span class="line">    m.save() <span class="comment">#保存</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponseRedirect(<span class="string">'/music/index'</span>) <span class="comment">#重定向到展示页面</span></span><br></pre></td></tr></table></figure>
<p>在模板文件中：</p>
<p>展示页面</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span> <span class="attr">cellpadding</span>=<span class="string">""</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">style</span>=<span class="string">"width: 500px"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                id</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                时间</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                名字</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                作者</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span></span><br><span class="line">                操作</span><br><span class="line">            <span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% for i in music_info %&#125; <span class="tag">&lt;<span class="name">--循环查看--</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                &#123;&#123; i.id &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">               &#123;&#123; i.time &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                &#123;&#123; i.name &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                &#123;&#123; i.auto_name &#125;&#125;</span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/music/replace/&#123;&#123; i.id &#125;&#125;"</span>&gt;</span>更新<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;<span class="name">--获得重定向带id的位置--</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"href="</span>/<span class="attr">music</span>/<span class="attr">delete</span>?<span class="attr">music_id</span>=<span class="string">&#123;&#123;</span> <span class="attr">i.id</span> &#125;&#125;""&gt;</span>删除<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        &#123;% empty %&#125;</span><br><span class="line">        &#123;% endfor %&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="admin"><a class="markdownIt-Anchor" href="#admin"></a> admin</h2>
<p>django提供了比较完善的后台管理数据库的接口，可供开发过程中调用和测试使用<br />
django会搜集所有已注册的模型类，为这些模型类提拱数据管理界面,供开发者使用</p>
<p>创建最高权限的账号</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createsuperuser</span><br></pre></td></tr></table></figure>
<h3 id="自定义模型类"><a class="markdownIt-Anchor" href="#自定义模型类"></a> 自定义模型类</h3>
<p>若要自己定义的模型类也能在/admin后台管理界中显示和管理，需要将自己的类注册到后台管理界面</p>
<p>注册步骤:<br />
1，在应用app中的admin.py中导入注册要管理的模型models类,如:from .models import Book<br />
2，调用admin.site.register方法进行注册,如:admin.site.register(自定义模型类)</p>
<h4 id="模型管理器类"><a class="markdownIt-Anchor" href="#模型管理器类"></a> 模型管理器类</h4>
<p>作用:<br />
为后台管理界面添加便于操作的新功能，显示上面的栏目。</p>
<p>说明:<br />
后台管理器类须继承自django.contrib.admin里的ModelAdmin类</p>
<p>再对应的app/admin.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Music</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BookManager</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = [<span class="string">"id"</span>, <span class="string">"title"</span>, <span class="string">"name"</span>, <span class="string">"defaulname"</span>]<span class="comment">#这个里面的字段对应的是模型类，里面有定义的字段选项verbose_name="名字"</span></span><br><span class="line">admin.site.register(Music, BookManager)<span class="comment">#用于绑定义的列表</span></span><br></pre></td></tr></table></figure>
<p>控制后台修改链接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_display_links = [<span class="string">'title'</span>]<span class="comment">#默认这个字段为可以修改的选项</span></span><br></pre></td></tr></table></figure>
<p>过滤器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_filter = [<span class="string">'defaulname'</span>] <span class="comment">#以defaulname为过滤条件</span></span><br></pre></td></tr></table></figure>
<p>搜索框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">search_fields = [<span class="string">'title'</span>]<span class="comment">#以title为查询索引</span></span><br></pre></td></tr></table></figure>
<p>添加在列表页编辑字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list_editable = [<span class="string">'name'</span>]</span><br></pre></td></tr></table></figure>
<p><a href="https://docs.djangoproject.com/en/2.2/ref/contrib/admin/" target="_blank" rel="noopener">https://docs.djangoproject.com/en/2.2/ref/contrib/admin/</a></p>
<p>在admin文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> Music, Author</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MusicManager</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = [<span class="string">"name"</span>, <span class="string">"time"</span>, <span class="string">"id"</span>, <span class="string">"auto_name"</span>, <span class="string">"is_active"</span>]</span><br><span class="line">    list_display_links = [<span class="string">"name"</span>, <span class="string">"time"</span>, <span class="string">"auto_name"</span>, ]</span><br><span class="line">    list_filter = [<span class="string">"name"</span>, <span class="string">"time"</span>, <span class="string">"id"</span>, <span class="string">"auto_name"</span>, <span class="string">"is_active"</span>]</span><br><span class="line">    search_fields = [<span class="string">"name"</span>, <span class="string">'time'</span>, <span class="string">"id"</span>]</span><br><span class="line">    list_editable = [<span class="string">"is_active"</span>, <span class="string">"id"</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthorManager</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">    list_display = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    search_fields = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line">    list_filter = [<span class="string">'age'</span>]</span><br><span class="line">    list_editable = [<span class="string">'name'</span>, <span class="string">'age'</span>]</span><br><span class="line"></span><br><span class="line">admin.site.register(Music, MusicManager)</span><br><span class="line">admin.site.register(Author, AuthorManager)</span><br></pre></td></tr></table></figure>
<p>在模型文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Music</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(<span class="string">"名字"</span>, max_length=<span class="number">50</span>, default=<span class="string">""</span>)</span><br><span class="line">    time = models.CharField(<span class="string">"时间"</span>, max_length=<span class="number">5</span>, default=<span class="string">"00:00"</span>)</span><br><span class="line">    id = models.IntegerField(<span class="string">"id"</span>, max_length=<span class="number">5</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    auto_name = models.CharField(<span class="string">"作者名称"</span>, max_length=<span class="number">50</span>, default=<span class="string">"NO"</span>)</span><br><span class="line">    is_active = models.BooleanField(<span class="string">"是否活跃"</span>, default=<span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"music"</span></span><br><span class="line">        verbose_name_plural = <span class="string">"音乐"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment">#return f"&#123;self.name&#125;//&#123;self.time&#125;//&#123;self.id&#125;//&#123;self.auto_name&#125;"</span></span><br><span class="line">    	<span class="keyword">return</span> name.self <span class="comment">#返回自己的名字，在后台中使用外键显示可以显示自己的名字</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    id = models.IntegerField(<span class="string">'id'</span>, max_length=<span class="number">10</span>, primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = models.CharField(<span class="string">"作者姓名"</span>, max_length=<span class="number">50</span>, default=<span class="string">'无名'</span>)</span><br><span class="line">    age = models.IntegerField(<span class="string">"年龄"</span>, max_length=<span class="number">3</span>, default=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">        db_table = <span class="string">"作者信息"</span></span><br><span class="line">        verbose_name_plural = <span class="string">'作者信息'</span></span><br></pre></td></tr></table></figure>
<h4 id="simple-ui"><a class="markdownIt-Anchor" href="#simple-ui"></a> simple ui</h4>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install django-simpleui</span><br></pre></td></tr></table></figure>
<p>在setting文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'simpleui'</span>,</span><br><span class="line">    ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>克隆静态文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 manage.py collectstatic</span><br></pre></td></tr></table></figure>
<p>如果克隆出错，在setting文件加入以下代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">"static"</span>)</span><br></pre></td></tr></table></figure>
<p>修改基础信息，<a href="http://xn--appadmin-z09lud3om0gnv6bby4alj1en5yf.py" target="_blank" rel="noopener">在任意一个app下面的admin.py</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">admin.site.site_title &#x3D; &quot;同剂商城管理系统&quot; #页面上的标题</span><br><span class="line">admin.site.site_header &#x3D; &quot;同剂商城管理系统&quot; #header上的名字</span><br></pre></td></tr></table></figure>
<p>在setting中定义其他内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">SIMPLEUI_CONFIG = &#123;</span><br><span class="line">      <span class="comment"># 是否使用系统默认菜单，自定义菜单时建议关闭。</span></span><br><span class="line">     <span class="string">'system_keep'</span>: <span class="literal">False</span>,</span><br><span class="line">     </span><br><span class="line">      <span class="comment"># 用于菜单排序和过滤, 不填此字段为默认排序和全部显示。空列表[] 为全部不显示.</span></span><br><span class="line">     <span class="string">'menu_display'</span>: [<span class="string">'1任务管理'</span>, <span class="string">'2权限认证'</span>],</span><br><span class="line">     </span><br><span class="line">     <span class="comment"># 设置是否开启动态菜单, 默认为False. 如果开启, 则会在每次用户登陆时刷新展示菜单内容。</span></span><br><span class="line">     <span class="comment"># 一般建议关闭。</span></span><br><span class="line">     <span class="string">'dynamic'</span>: <span class="literal">False</span>,</span><br><span class="line">     <span class="string">'menus'</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">             <span class="string">'app'</span>: <span class="string">'auth'</span>,</span><br><span class="line">             <span class="string">'name'</span>: <span class="string">'2权限认证'</span>,</span><br><span class="line">             <span class="string">'icon'</span>: <span class="string">'fas fa-user-shield'</span>,</span><br><span class="line">             <span class="string">'models'</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                 <span class="string">'name'</span>: <span class="string">'用户列表'</span>,</span><br><span class="line">                 <span class="string">'icon'</span>: <span class="string">'fa fa-user'</span>,</span><br><span class="line">                 <span class="string">'url'</span>: <span class="string">'auth/user/'</span></span><br><span class="line">                &#125;,</span><br><span class="line">                &#123;</span><br><span class="line">                     <span class="string">'name'</span>: <span class="string">'用户组'</span>,</span><br><span class="line">                     <span class="string">'icon'</span>: <span class="string">'fa fa-th-list'</span>,</span><br><span class="line">                     <span class="string">'url'</span>: <span class="string">'auth/group/'</span></span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line"> </span><br><span class="line">        &#123;</span><br><span class="line">             <span class="string">'name'</span>: <span class="string">'1任务管理'</span>,</span><br><span class="line">             <span class="string">'icon'</span>: <span class="string">'fa fa-th-list'</span>,</span><br><span class="line">             <span class="string">'models'</span>: [</span><br><span class="line">                &#123;</span><br><span class="line">                 <span class="string">'name'</span>: <span class="string">'任务列表'</span>,</span><br><span class="line">                 <span class="comment"># 注意url按'/admin/应用名小写/模型类名小写/'命名。 </span></span><br><span class="line">                 <span class="string">'url'</span>: <span class="string">'/admin/tasks/task/'</span>,</span><br><span class="line">                 <span class="string">'icon'</span>: <span class="string">'fa fa-tasks'</span></span><br><span class="line">                &#125;,</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">    ]</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="关系映射"><a class="markdownIt-Anchor" href="#关系映射"></a> 关系映射</h2>
<p>在关系型数据库中，通常不会把所有数<br />
据都放在同一张表中，不易<br />
于扩展，常见关系映射有:<br />
1.—对一映射<br />
如:一个身份证对应一个人</p>
<p>2.一对多映射<br />
如:一个班级可以有多个学生</p>
<p>3.多对多映射<br />
如:一个学生可以报多个课程，—个课程可以有多个学生学习</p>
<h3 id="一对一映射"><a class="markdownIt-Anchor" href="#一对一映射"></a> 一对一映射</h3>
<p>—对一是表示现实事物间存在的一对一的对应关系。</p>
<p>语法：OneToOneField(类名，on_delete=)</p>
<p>在模型文件需要绑定的类中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">book</span><span class="params">(models.Model)</span></span></span><br><span class="line">	name = models.CharField("名字",max_length=11)</span><br><span class="line">	author = models.OneToOneField(类名，on_delete=models.CASCADE) <span class="comment">#绑定需要关联的表</span></span><br></pre></td></tr></table></figure>
<ul>
<li>特殊字段选项【必须】</li>
<li>on_delete - 级联删除</li>
</ul>
<ol>
<li>models.CASCADE级联删除。Django模拟SQL约束ON DELETE CASCADE的行为，并删除包含ForeignKey的对象。</li>
<li>models.PROTECT 抛出ProtectedError 以阻止被引用对象的删除;[等同于mysql默认的RESTRICT]</li>
<li>SET_NULL设置ForeignKey null;需要指定null=True</li>
<li>SET_DEFAULT 将ForeignKey设置为其默认值;必须设置ForeignKey的默认值。</li>
</ol>
<ul>
<li>无外键的模型类[Author]:<br />
author1 = Author.objects.create（naem=“Blosslom”）</li>
<li>有外键的模型类[book]<br />
book = book.objects.create(name=“python”， author=author1)#关联Blosslom的类</li>
<li>book = Wife.objects.create(name=‘python’，id=1)#关联Blosslom对应主键值</li>
</ul>
<h4 id="创建"><a class="markdownIt-Anchor" href="#创建"></a> 创建</h4>
<p>先创建无外键的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">author1 = Author.objects.create（naem=<span class="string">"Blosslom"</span>）<span class="comment">#在模型层里的属于class author类</span></span><br><span class="line">book = book.objects.create(name=<span class="string">"python"</span>， author=author1)<span class="comment">#通过导入的author类所创建的对象绑定</span></span><br><span class="line">book = book.objects.create(name=<span class="string">'python'</span>，author_id=<span class="number">1</span>)<span class="comment">#通过author类的id字段进行绑定</span></span><br></pre></td></tr></table></figure>
<h4 id="查询"><a class="markdownIt-Anchor" href="#查询"></a> 查询</h4>
<p>1，正向查询:直接通关外键属性查询，则称为正向查询，有外键的字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> book <span class="comment">#</span></span><br><span class="line">book1 = book.objects.create(name=<span class="string">'python'</span>)</span><br><span class="line">print(<span class="string">f"<span class="subst">&#123;book1&#125;</span>的作者是<span class="subst">&#123;book1.author.name&#125;</span>"</span>)<span class="comment">#通过外键属性查询</span></span><br></pre></td></tr></table></figure>
<p>2，反向查询-没有外键属性的一方，可以调用反向属性查询到关联的另一方</p>
<p>反向关联实例化对象名.关联类名小写.属性</p>
<p>在模型文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span></span></span><br><span class="line">	name = models.CharField("名字",max_length=11)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Book</span><span class="params">(models.Model)</span></span></span><br><span class="line">	name = models.CharField("名字",max_length=11)</span><br><span class="line">	author = models.OneToOneField(类名，on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Author</span><span class="params">(models.Model)</span></span></span><br><span class="line">author1 = Author.objects.get(name = '')</span><br><span class="line">book1 = author1.book.name</span><br></pre></td></tr></table></figure>
<h3 id="一对多映射"><a class="markdownIt-Anchor" href="#一对多映射"></a> 一对多映射</h3>
<p>一对多是表示现实事物间存在的一对多的对应关系。</p>
<p>如:—个学校有多个班级,—个班级有多个学生,一本图书只能属于一个出版社,一个出版社允许出版多本图书<br />
—对多需要明确出具体角色，在多表上设置外键</p>
<p>在需要绑定的多键值中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(<span class="string">'用户名'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Address</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    address = models.CharField(<span class="string">'用户地址'</span>, max_length=<span class="number">200</span>)</span><br><span class="line">    user = models.ForeignKey(User, on_delete=models.CASCADE)</span><br></pre></td></tr></table></figure>
<h4 id="创建-2"><a class="markdownIt-Anchor" href="#创建-2"></a> 创建</h4>
<p>先创建一，再创建多</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">user1 = models.objects.create(name=<span class="string">''</span>)</span><br><span class="line">address1 = models.objects.create(name=<span class="string">''</span>,user=user1)</span><br><span class="line">address2 = models.objects.create(name=<span class="string">''</span>,user=user1)</span><br><span class="line">address2 = models.objects.create(name=<span class="string">''</span>,user_id=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<h4 id="查询-2"><a class="markdownIt-Anchor" href="#查询-2"></a> 查询</h4>
<p>1，正向查询[通过address查询user</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line">address1 = Address.objects.get(name=<span class="string">''</span>)</span><br><span class="line">user1_name = address1.user.name <span class="comment">#正向查询user是放置在模型文件中的键值绑定</span></span><br></pre></td></tr></table></figure>
<p>反向查询[通过Publisher查询对应的所有的Book]</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user1 = User.objects.get(name=<span class="string">''</span>)<span class="comment">#获取一个对象</span></span><br><span class="line">address1 = user1.address_set.all()<span class="comment">#所关联的类名小写_set</span></span><br></pre></td></tr></table></figure>
<h3 id="多对多映射"><a class="markdownIt-Anchor" href="#多对多映射"></a> 多对多映射</h3>
<p>多对多表达对象之间多对多复杂关系，如:每个人都有不同的学校(小学，初中，高中…),每个学校都有不同的学生…</p>
<p>mysql中创建多对多需要依赖第三张表来实现<br />
Django中无需手动创建第三张表, Django自动完成</p>
<p>语法:在关联的两个类中的任意一个类中,增加:属性= models.ManyToManyField(MyModel)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Manufactor</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    maker = models.CharField(<span class="string">'生产者'</span>, max_length=<span class="number">50</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Goods</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">    name = models.CharField(<span class="string">'装配体'</span>, max_length=<span class="number">50</span>)</span><br><span class="line">    manufactor = models.ManyToManyField(Manufactor) <span class="comment">#没有多余的要求</span></span><br></pre></td></tr></table></figure>
<h4 id="创建-3"><a class="markdownIt-Anchor" href="#创建-3"></a> 创建</h4>
<p>多对多先创建谁都无所谓</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> *</span><br><span class="line">maker1 = Manufactor.objects.create(maker=<span class="string">''</span>)</span><br><span class="line">maker2 = Manufactor.objects.create(maker=<span class="string">''</span>)</span><br><span class="line">goods1 = maker1.goods_set.create(name=<span class="string">''</span>) <span class="comment">#第一种绑定方法</span></span><br><span class="line">maker2.goods_set.add(goods1)<span class="comment">#第二种绑定方法，已经有了一个对象</span></span><br></pre></td></tr></table></figure>
<p>所有都是没有外键操作的类都使用反向的类名_set</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> .models <span class="keyword">import</span> * <span class="comment">#先创建有外键的</span></span><br><span class="line">good = good.object.create(name=<span class="string">''</span>)</span><br><span class="line">maker = good.manufactor.create(maker=<span class="string">''</span>)<span class="comment">#第一种绑定方法</span></span><br><span class="line">good.manufactor.add(maker)<span class="comment">#第二种绑定方法</span></span><br></pre></td></tr></table></figure>
<p>正向查询</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">good = goods.objects.get(name=<span class="string">''</span>)</span><br><span class="line">good.manufactor.all()</span><br><span class="line">good.manufactor.filter()</span><br></pre></td></tr></table></figure>
<p>反向</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">maker = manufactor.objects.get(maker=<span class="string">''</span>)</span><br><span class="line">maker.goods_set.all()</span><br><span class="line">maker.goods_set.filter()</span><br></pre></td></tr></table></figure>
<h2 id="cookiessession"><a class="markdownIt-Anchor" href="#cookiessession"></a> cookies&amp;session</h2>
<p>cookies是存储在客户端浏览器上的</p>
<p>Chrome浏览器可能通过开发者工具的Application &gt;&gt;Storage &gt;&gt; <code>Cookies</code>查看和操作浏览器端所有的Cookies值</p>
<ul>
<li>cookies在浏览器上是以键-值对的形式进行存储的，键和值都是以ASCII字符串的形存储(不能是中文字符串)</li>
<li>存储的数据带有生命周期</li>
<li>cookies中的数据是按域存储隔离的,不同的域之间无法访问</li>
<li>cookies的内部的数据会在每次访问此网址时都会携带到服务器端，如果cookies过大会降低响应速度</li>
</ul>
<p>HttpResponse.set_cookie(key, value=’’, max_age=None,expires=None)</p>
<ul>
<li>key:cookie的名字</li>
<li>value:cookie的值</li>
<li>max_age:cookie存活时间，秒为单位</li>
<li>expires:具体过期时间</li>
<li>当不指定max_age和expires时,关闭浏览器时此数据失效</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cookies</span><span class="params">(request)</span>:</span></span><br><span class="line">    req = HttpResponse(<span class="string">'request cookie'</span>) <span class="comment">#定义返回值</span></span><br><span class="line">    req.set_cookie(<span class="string">'uname'</span>, <span class="string">'Blosslom'</span>, <span class="number">5000</span>) <span class="comment">#在返回值中设置cookie</span></span><br><span class="line">    <span class="keyword">return</span> req <span class="comment">#返回带cookie的信息</span></span><br></pre></td></tr></table></figure>
<p>在视图函数中写cookies</p>
<ul>
<li>删除Cookies</li>
<li>HttpResponse.delete_cookie(key)-删除指定的key 的Cookie。</li>
<li>如果key不存在则什么也不发生<br />
获取Cookies</li>
<li>通过request.COOKIES 绑定的字典(dict)获取客户端的COOKIES数据</li>
<li>value = request.COOKIES.get(‘cookies名’,‘默认值’)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_cookie</span><span class="params">(request)</span>:</span></span><br><span class="line">    cok = request.COOKIES.get(<span class="string">'uname'</span>) <span class="comment">#获取cookie</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f"cookie is <span class="subst">&#123;cok&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
<p>session是在服务器上开辟一段空间用于保留浏览器和服务器交互时的重要数据<br />
实现方式<br />
使用session需要在浏览器客户端启动cookie，且在cookie中存储sessionid<br />
每个客户端都可以在服务器端有一个独立的Session-注意:不同的请求者之间不会共享这个<br />
数据,与请求者一一对应</p>
<p>在setting中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">]</span><br><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>session对于象是一个类似于字典的SessionStore类型的对象,可以用类拟于字典的方式进行操作</p>
<p>session 能够存储如字符串，整型，字典,<br />
列表等。</p>
<ul>
<li>1，保存session的值到服务器</li>
<li>request.session[‘KEY’] = VALUE</li>
<li>2，获取session的值</li>
<li>value = request.session[‘KEY’]<br />
value = request.session.get(‘KEY’,默认值)</li>
<li>3，删除session</li>
<li>del request.session[‘KEY’]</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_session</span><span class="params">(request)</span>:</span></span><br><span class="line">    request.session[<span class="string">'uname'</span>] = <span class="string">'this is session'</span></span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">'get a session'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_session</span><span class="params">(request)</span>:</span></span><br><span class="line">    ses = request.session.get(<span class="string">'uname'</span>)</span><br><span class="line">    <span class="keyword">return</span> HttpResponse(<span class="string">f"you are session is <span class="subst">&#123;ses&#125;</span>"</span>)</span><br></pre></td></tr></table></figure>
<p>settings.py中相关配置项</p>
<ol>
<li>SESSION_COOKIE_AGE<br />
作用:指定sessionid在cookies中的保存时长(默认是2周)，如下:例如:SESSION_COOKIE_AGE= 60*60*24*7*2</li>
<li>SESSION_EXPIRE_AT_BROWSER_CLOSE= True设置只要浏览器关闭时,session就失效(默认为False)</li>
<li>注意:Django中的session数据存储在数据库中，所以使用session前需要确保已经执行过migrate</li>
</ol>
<p>1, django_session表是单表设计;且该表数据量持续增持【浏览器故意删掉sessionid&amp;过期数据未删除】<br />
2、可以每晚执行python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> clearsessions【该命令可删除已过期的session数据】</p>
<h2 id="哈希算法"><a class="markdownIt-Anchor" href="#哈希算法"></a> 哈希算法</h2>
<p>md5：32位16进制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">m = hashlib.md5() <span class="comment">#创建一个对象</span></span><br><span class="line">m.update(<span class="string">b'13246'</span>) <span class="comment">#更新对象的值</span></span><br><span class="line">m.hexdigest() <span class="comment">#显示十六禁止</span></span><br><span class="line"><span class="string">'51cece00aed19468f18042ad0606a3d3'</span></span><br><span class="line">m.digest() <span class="comment">#进行二进制不可视字符</span></span><br><span class="line">m.update(<span class="string">b'123'</span>)<span class="comment">#累加了12346</span></span><br></pre></td></tr></table></figure>
<h2 id="缓存"><a class="markdownIt-Anchor" href="#缓存"></a> 缓存</h2>
<p>在setting文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.db.DatabaseCache'</span>,</span><br><span class="line">        <span class="string">'LOCATION'</span>: <span class="string">'my_cache_table'</span>,</span><br><span class="line">        <span class="string">'TIMEOUT'</span>: <span class="number">300</span>,  <span class="comment"># 缓存保存时间单位秒,默认值为300</span></span><br><span class="line">        <span class="string">'OPTIONS'</span>: &#123;</span><br><span class="line">            <span class="string">'MAX_ENTRIES'</span>: <span class="number">300</span>,  <span class="comment"># 缓存最大数据条数</span></span><br><span class="line">            <span class="string">'CULL_FREQUENCY'</span>: <span class="number">2</span>,  <span class="comment"># 缓存条数达到最大值时删除1/x的缓存数据</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在python中创建一个表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py createcachetable</span><br></pre></td></tr></table></figure>
<h3 id="全局缓存"><a class="markdownIt-Anchor" href="#全局缓存"></a> 全局缓存</h3>
<p>在路由里面写缓存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, cache_page(<span class="number">60</span>)(admin.site.urls)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>在视图函数中写缓存</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.cache <span class="keyword">import</span> cache_page</span><br><span class="line"></span><br><span class="line"><span class="meta">@cache_page(30) #30表示存30秒</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h3 id="局部缓存"><a class="markdownIt-Anchor" href="#局部缓存"></a> 局部缓存</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.cache <span class="keyword">import</span> cache</span><br><span class="line">cache.set(<span class="string">'key'</span>,<span class="string">'mydata'</span>,<span class="number">50</span>)<span class="comment">#用key名字，存mydata存储50秒</span></span><br><span class="line">cache.get(<span class="string">'key'</span>)</span><br></pre></td></tr></table></figure>
<p>1， cache.set(key, value, timeout)-存储缓存</p>
<p>key:缓存的key,字符串类型<br />
value:Python对象<br />
timeout:缓存存储时间(s)，默认为CACHES中的TIMEOUT值<br />
返回值: None</p>
<p>2, cache.get(key)- 获取缓存</p>
<p>key:缓存的key<br />
返回值:为key的具体值，如果没有数据<br />
则返回None</p>
<p>3, cache.add(key, value)-存储缓存,只在key不存在时生效返回值: True[存储成功]or False[存储失败]</p>
<p>4, cache.get_or_set(key, value, timeout)-如果未获取到数据则执行set操作返回值: value</p>
<p>5, cache.set_many(dict,timeout)-批量存储缓存dict: key和value的字典<br />
timeout:存储时间(s)<br />
返回值:插入不成功的key的数组</p>
<p>6, cache.get_many(key_list)-批量获取缓存数据<br />
心<br />
key_list:包含key的数组<br />
返回值:取到的key和value的字典</p>
<p>7, cache.delete(key)-删除key的缓存数据返回值:None</p>
<p>8, cache.delete_many(key_list)- 批量删除返回值: None</p>
<h3 id="浏览器缓存"><a class="markdownIt-Anchor" href="#浏览器缓存"></a> 浏览器缓存</h3>
<p>不会向服务器发送请求，直接从缓存中读取资源1，响应头–Expires<br />
定义:缓存过期时间，用来指定资源到期的时间，是服务器端的具体的时间点<br />
样例: Expires:Thu, 02 Apr 2030 05:14:08 GMT</p>
<p>2，响应头-Cache-Control<br />
在HTTP/1.1中，Cache-Control主要用于控制网页缓存。比如当`Cache-Control:max-age=120代表请求创建时间后的120秒，缓存失效<br />
说明:目前服务器都会带着这两个头同时响应给浏览器，浏览器优先使用Cache-Control</p>
<p>3,Last-Modified响应头和If-Modified-Since请求头说明:<br />
Last-Modified为文件的最近修改时间，浏览器第一次请求静态文件时，服务器如果返回Last-Modified响应头，则代表该资源为需协商的缓存<br />
当缓存到期后，浏览器将获取到的Last-Modified值做为请求<br />
头lf-Modified-Since的值，与服务器发请求协商，服务端返回304响应码[响应体为空]．代表缓存继续使用，200响应码代表缓存不可用[响应体为最新资源]</p>
<p>4，Etag是服务器响应请求时，返回当前资源文件的一个唯一标识(由服务器生成)，只要资源有变化, Etag就会重新生成。</p>
<h2 id="中间件"><a class="markdownIt-Anchor" href="#中间件"></a> 中间件</h2>
<p>中间件是 Django 请求/响应处理的钩子框架。它是一个轻量级的、低级的“插件&quot;系统，用于全局改变 Django的输入或输出。</p>
<p>中间件以类的形式体现</p>
<p>每个中间件组件负责做一些特定的功能。例如, Django 包含一个中间件组件AuthenticationMiddleware，它使用会话将用户与请求关联起来。</p>
<p>中间件类须继承自django.utils.deprecation.MiddlewareMixin类</p>
<p>中间件类须实现下列五个方法中的一个或多个:</p>
<p>process_request(self, request)<br />
执行路由之前被调用，在每个请求上调用，返回None可以进入下一个环节或HttpResponse对象</p>
<p>process_view(self, request, callback, callback_args,callback_kwargs)<br />
调用视图之前被调用，在每个请求上调用，返回None或HttpResponse对象</p>
<p>process_response(self, request, response)<br />
所有响应返回浏览器被调用，在每个请求上调用，response是视图函数return的内容，返回HttpResponse对象</p>
<p>process_exception(self, request, excepption)<br />
当处理过程中抛出异常时调用，返回一个HttpResponse对象</p>
<p>process_template response(self, request, response)<br />
在视图函数执行完毕且试图返回的对象中包含render方法时被调用;该方法需要返回实现了render方法的响应对象<br />
注:中间件中的大多数方法在返回None时表示忽略当前操作进入下一项事件，当返回HttpResponese对象时表示此请求结束，直接返回给客户端</p>
<p>再settings.py中需要注册一下自定义的中间件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MIDDLEWARE = [</span><br><span class="line">    <span class="string">'django.middleware.security.SecurityMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions.middleware.SessionMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.common.CommonMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.csrf.CsrfViewMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth.middleware.AuthenticationMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages.middleware.MessageMiddleware'</span>,</span><br><span class="line">    <span class="string">'django.middleware.clickjacking.XFrameOptionsMiddleware'</span>,</span><br><span class="line">    <span class="string">'middleware.first_midware.Request'</span>, <span class="comment">#注册的中间件</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>再项目文件夹下创建middleware的软件包，再创建py文件</p>
<p>注意:配置为数组，以视图为分界，中间件被调用时以’先上到下’再‘由下到上的顺序调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Request</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        print(<span class="string">'before url'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_view</span><span class="params">(self, reqeust, callback, callback_args, callback_kwargs)</span>:</span></span><br><span class="line">        print(<span class="string">'before view'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self, reqeust, response)</span>:</span></span><br><span class="line">        print(<span class="string">'after view'</span>)</span><br><span class="line">        <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<p>request.META['REMOTE_ADDR&quot;]可以得到远程客户端的IP地址</p>
<p>reqeust.path_info获取用户当前访问的路径 返回形式不带ip和端口是 /路径/</p>
<p>request.path_ info 可以得到客户端访问的请求路由信息</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LimitVisit</span><span class="params">(MiddlewareMixin)</span>:</span></span><br><span class="line">    visit_dic = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self, reqeust)</span>:</span></span><br><span class="line">        <span class="comment"># 获取IP地址</span></span><br><span class="line">        ip_address = reqeust.META[<span class="string">'REMOTE_ADDR'</span>]</span><br><span class="line">        <span class="comment"># 获取路径访问路径为相对路径/test</span></span><br><span class="line">        path = reqeust.path_info</span><br><span class="line">        <span class="comment"># 使用正则匹配路径</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.match(<span class="string">'^/test'</span>, path):</span><br><span class="line">            <span class="comment"># 通过返回None</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        <span class="comment"># 使用字典的get获取这个IP的访问次数get方法如果没有这个ip则返回一个默认值</span></span><br><span class="line">        times = self.visit_dic.get(ip_address, <span class="number">0</span>)</span><br><span class="line">        <span class="comment"># 使得这个ip次数+1,没有这个ip则会自动添加</span></span><br><span class="line">        self.visit_dic[ip_address] = times + <span class="number">1</span></span><br><span class="line">        <span class="comment"># 判断ip访问次数是否大于5</span></span><br><span class="line">        <span class="keyword">if</span> self.visit_dic[ip_address] &gt; <span class="number">5</span>:</span><br><span class="line">            <span class="comment"># 大于5禁止访问</span></span><br><span class="line">            <span class="keyword">return</span> HttpResponse(<span class="string">'访问'</span>+str(self.visit_dic[ip_address])+<span class="string">'禁止访问'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="csrf跨站伪造请求攻击"><a class="markdownIt-Anchor" href="#csrf跨站伪造请求攻击"></a> CSRF跨站伪造请求攻击</h2>
<p>某些恶意网站上包含链接、表单按钮或者JavaScript,它们会利用登录过的用户在浏览器中的认证信息试图在<br />
你的网站上完成某些操作，这就是跨站请求伪造(CSRF，即Cross-Site Request Forgey)。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">django.middleware.csrf.CsrfViewMiddleware</span><br><span class="line">对应标签加在form中任意位置&#123;% csrf_token %&#125;</span><br></pre></td></tr></table></figure>
<p>特殊说明:<br />
如果某个视图不需要django进行csrf保护，可以用装饰器关闭对此视图的检查<br />
样例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.views.decorators.csrf <span class="keyword">import</span> csrf_exempt</span><br><span class="line"><span class="meta">@csrf_exempt</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_view</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">'Hello wor1d'</span>)</span><br></pre></td></tr></table></figure>
<p>分页是指在web页面有大量数据需要显示，为了阅读方便在每页页中只显示部分数据。<br />
优点:<br />
1.方便阅读<br />
2.减少数据提取量，减轻服务器压力。</p>
<ul>
<li>
<p>Django提供了Paginator类可以方便的实现分页功能</p>
</li>
<li>
<p>Paginator类位于<code>django.core.paginator</code>模块中。</p>
</li>
<li>
<p>负责分页数据整体的管理</p>
</li>
<li>
<p>对象的构造方法<br />
paginator = Paginator(object list, per_page)<br />
-参数</p>
<ul>
<li>
<p>object_list 需要分货数据的对象列表- per_page每页数据个数<br />
-返回值:</p>
<p>Paginator的对象</p>
<ul>
<li>count:需要分页数据的对象总数</li>
<li>num_pages:分页后的页面总数</li>
<li>page_range:从1开始的range对象，用于记录当前面码数</li>
<li>per_page 每页数据的个数</li>
</ul>
<p>paginator对象</p>
<p>.page(number)<br />
-参数number为页码信息(从1开始)</p>
<p>返回当前number页对应的页信息<br />
如果提供的页码不存在，抛出InvalidPage异常</p>
<p>lnvalidPage:总的异常基类,包含以下两个异常子类</p>
<ul>
<li>PageNotAnInteger:当向page()作传入一个不是整数的值时抛出</li>
<li>EmptyPage:当尚page()提供一个有效值,但是那个页面上没有任何对象时抛出</li>
</ul>
<p>负责具体某一页的数据的管理创建对象<br />
Paginator对象的page()方法返回Page对象<br />
page = paginator.page(页码)<br />
Page对象属性</p>
<ul>
<li>object_list:当前页上所有数据对象的列表-</li>
<li>number:当前页的序号，从1开始</li>
<li>gaginator:当前page对象相关的Paginator对象</li>
<li>has_next():如果有下一页返回True</li>
<li>has_previous():如果有上一页返回True</li>
<li>has_other_pages():如果有上一页或下页返回True</li>
<li>next_page_number():返回下一页的页码，如果下一页不存在，抛出InvalidPage异常</li>
<li>previous_page_number():返回上一页的页码，如果上一页不存在，抛出InvalidPage异常</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_page</span><span class="params">(request)</span>:</span></span><br><span class="line">    page_num = request.GET.get(<span class="string">'page'</span>) <span class="comment">#GET请求获取需要的页数</span></span><br><span class="line">    all_data = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>,</span><br><span class="line">                <span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'a'</span>, <span class="string">'b'</span>]</span><br><span class="line">    paginator = Paginator(all_data, <span class="number">3</span>) <span class="comment">#创建一个对象，每页放三个数据</span></span><br><span class="line">    page_manager = paginator.page(int(page_num)) <span class="comment">#使用page管理每个页面的内容int(page)是需要管理的页面</span></span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'page.html'</span>, locals()) <span class="comment">#返回字典</span></span><br></pre></td></tr></table></figure>
<p>在html文件中</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&#123;<span class="comment">#循环page里的数据#&#125;</span></span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> page %&#125;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &#123;&#123; i &#125;&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line">    </span><br><span class="line">&#123;<span class="comment">#下方页面栏，判断是否为最前面一页，是的话就返回True#&#125;</span></span><br><span class="line">&#123;% <span class="keyword">if</span> page.has_previous %&#125;</span><br><span class="line">    &lt;a href="/test_page?page=&#123;&#123; page.previous_page_number &#125;&#125;"&gt;上一页&lt;/a&gt;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">    上一页</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">    </span><br><span class="line">&#123;<span class="comment">#循环页面范围#&#125;</span></span><br><span class="line">&#123;% <span class="keyword">for</span> i <span class="keyword">in</span> paginator.page_range %&#125;</span><br><span class="line">&#123;<span class="comment">#    如果page在当前页面就显示为正常字符串#&#125;</span></span><br><span class="line">    &#123;% <span class="keyword">if</span> i == page.number %&#125;</span><br><span class="line">        &#123;&#123; i &#125;&#125;</span><br><span class="line">&#123;<span class="comment">#    否则就是超链接#&#125;</span></span><br><span class="line">    &#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">        &lt;a href="/test_page?page=&#123;&#123; i &#125;&#125;"&gt;&#123;&#123; i &#125;&#125;&lt;/a&gt;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">&#123;% empty %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="comment">#判断是否在最后一页#&#125;</span></span><br><span class="line">&#123;% <span class="keyword">if</span> page.has_next %&#125;</span><br><span class="line">    &lt;a href="/test_page?page=&#123;&#123; page.next_page_number &#125;&#125;"&gt;下一页&lt;/a&gt;</span><br><span class="line">&#123;% <span class="keyword">else</span> %&#125;</span><br><span class="line">    下一页</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h2 id="csv文件"><a class="markdownIt-Anchor" href="#csv文件"></a> CSV文件</h2>
<p>逗号分隔值(Comma-Separated Values,CSV，有时也称为字符分隔值，因为分隔字符也可以不是逗号)，其文件以纯文本形式存储表格数据（数字和文本)<br />
说明:可被常见制表工具，如excel等直接进行读取Python提供了内建库csv;可直接通过该库操作csv文件案例如下:<br />
import csv<br />
with open(‘eggs.csv’, ‘w’, newline=&quot;) as csvfile:<br />
writer = csv.writer(csvfile)<br />
writer.writerow([‘a’ , ‘b’, ‘c’])</p>
<p>在网站中，实现下载CSV，注意如下:<br />
响应Content-Tyoe类型需修改为text/csv。这告诉浏览器该文档是CSV文件，而不是HTML文件<br />
响应会获得一个额外的Content-Disposition标头，其中包含CSV文件的名称。它将被浏览器用于开启“另存为…&quot;对话框</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_csv</span><span class="params">(request)</span>:</span></span><br><span class="line">    response = HttpResponse(content_type=<span class="string">'text/csv'</span>)</span><br><span class="line">    response[<span class="string">'Content-Disposition'</span>] = <span class="string">'attachment;filename="test.csv"'</span></span><br><span class="line">    all_data = [[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>], [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</span><br><span class="line">                [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> all_data:</span><br><span class="line">        write = csv.writer(response)</span><br><span class="line">        write.writerow(i)</span><br><span class="line">    <span class="keyword">return</span> response</span><br></pre></td></tr></table></figure>
<h2 id="上传"><a class="markdownIt-Anchor" href="#上传"></a> 上传</h2>
<h3 id="在前端"><a class="markdownIt-Anchor" href="#在前端"></a> 在前端</h3>
<p>文件上传必须为POST提交方式<br />
表单<code>&lt;form&gt;</code>中文件上传时必须有带有enctype= &quot;multipart/form-data&quot;时才会包含文件内容数据。<br />
表单中用<input type="file" name="xxx"><br />
标签上传文件</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">''</span> <span class="attr">methon</span>=<span class="string">''</span> <span class="attr">enctype</span>= <span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"xxx"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在后端"><a class="markdownIt-Anchor" href="#在后端"></a> 在后端</h3>
<p>视图函数中,用request.FILES取文件框的内容<br />
file=request.FILES[‘xxx’]<br />
说明: 1，FILES的key对应页面中file框的name值<br />
2, file 绑定文件流对象，<br />
3, file.name文件名<br />
4, file.file文件的字节流数据</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">up_file = request.FILES[<span class="string">'file'</span>] <span class="comment">#file是form中的name</span></span><br><span class="line">up_file.name</span><br><span class="line">data = up_file.file.read() <span class="comment">#获得文件数据</span></span><br></pre></td></tr></table></figure>
<h3 id="在setting中"><a class="markdownIt-Anchor" href="#在setting中"></a> 在setting中</h3>
<p>配置文件的访问路径和存储路径<br />
在setting.py中设置MEDIA相关配置;Django把用户上传的文件，统称为media资源<br />
Django把用户上传的文件，统称为media资源</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br><span class="line">MEDIA__ROOT = os.path.join(BASE_DIR,<span class="string">' media'</span> ) <span class="comment">#资源上传后的路径</span></span><br></pre></td></tr></table></figure>
<p>MEDIA_URL和MEDIA_ROOT需要手动绑定</p>
<p>步骤:主路由中添加路由</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django. conf <span class="keyword">import</span> settings</span><br><span class="line"><span class="keyword">from</span> django.conf.urls.static <span class="keyword">import</span> static</span><br><span class="line">urlpatterns += static(settings.MEDIA_URL,document_root=settings.MEDIA_ROOT)</span><br></pre></td></tr></table></figure>
<p>说明:等价于做了MEDIA_URL开头的路由，Django接到该特征请求后去MEDIA_ROOT路径查找资源</p>
<p>借助ORM</p>
<p>FileField(upload_to=‘子目录名’)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">up_file = request.FILES[<span class="string">'file'</span>]</span><br><span class="line">类名.objects.create(file = up_file)</span><br></pre></td></tr></table></figure>
<h2 id="邮件发送"><a class="markdownIt-Anchor" href="#邮件发送"></a> 邮件发送</h2>
<p>SMTP的全称是&quot;Simple Mail Transfer Protocol&quot;，即简单邮件传输协议(25号端口)。<br />
它是一组用于从源地址到目的地址传输邮件的规范，通过它来控制邮件的中转<br />
属于“推送”协议</p>
<p>IMAP全称是lnternet Mail Access Protocol,<br />
即交互式邮件访问协议，是一个应用层协议（端口是143)。<br />
用来从本地邮件客户端(Outlook Express.Foxmail、Mozilla Thunderbird等）访问远程服务器上的邮件属于“拉取”协议</p>
<p>两者均为“拉取&quot;型协议，负责从邮件服务器中下载邮件</p>
<ul>
<li>IMAP具备摘要浏览功能，可预览部分摘要，再下载整个邮件<br />
IMAP为双向协议，客户端操作可反馈给服务器</li>
<li>POP3必须下载全部邮件，无摘要功能<br />
POP3为单向协议，客户端操作无法同步服务器</li>
</ul>
<p>Django中配置邮件功能，主要为SMTP协议，负责发邮件</p>
<p>原理:<br />
给Django授权一个邮箱<br />
Django用该邮箱给对应收件人发送邮件<br />
django.core.mail封装了电子邮件的自动发送SMTP协议</p>
<p>在setting文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">EMAIL_BACKEND = <span class="string">'django.core.mail.backends.smtp.EmailBackend'</span></span><br><span class="line">EMAIL_HOST = <span class="string">'smtp.qq.com'</span><span class="comment">#腾讯QQ邮箱SMTP服务器地址</span></span><br><span class="line">EMAIL_PORT = <span class="number">25</span> <span class="comment"># SMTP服务的端口号</span></span><br><span class="line">EMAIL_HOST_USER =‘xxxx@qq.com’<span class="comment">#发送邮件的QQ邮箱</span></span><br><span class="line">EMAIL_HOST_PASSWORD =<span class="string">''</span> <span class="comment">#在QQ邮箱-&gt;设置-&gt;帐户-&gt;“POP3/IMAP.....服务”里得到的在第三方登录QQ邮箱授权码</span></span><br><span class="line">EMAIL_USE_TLS = <span class="literal">False</span> <span class="comment">#与SMTP服务器通信时，是否启动TLS链接(安全链接)默认False</span></span><br></pre></td></tr></table></figure>
<p>在视图文件中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> mail</span><br><span class="line">mail.send_mail(subject=<span class="string">''</span>,<span class="comment">#题目</span></span><br><span class="line">               message=<span class="string">''</span>,<span class="comment">#消息内容</span></span><br><span class="line">               from_email=<span class="string">''</span>,<span class="comment"># 发送者[当前配邮箱]</span></span><br><span class="line">               recipient_list=[<span class="string">'xxx@qq.com'</span>]，<span class="comment">#接收者邮件列表</span></span><br><span class="line">              )</span><br></pre></td></tr></table></figure>
<p>发送html邮件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.core.mail <span class="keyword">import</span> EmailMessage</span><br><span class="line"><span class="keyword">from</span> django.template <span class="keyword">import</span> loader</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> settings <span class="keyword">import</span> EMAIL_HOST_USER   <span class="comment">#项目配置邮件地址，请参考发送普通邮件部分</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_html_mail</span><span class="params">(subject, html_content, recipient_list)</span>:</span></span><br><span class="line">    msg = EmailMessage(subject, html_content, EMAIL_HOST_USER, recipient_list)</span><br><span class="line">    msg.content_subtype = <span class="string">"html"</span> <span class="comment"># Main content is now text/html</span></span><br><span class="line">    msg.send()</span><br><span class="line"></span><br><span class="line">subject = <span class="string">u'邮件主题'</span></span><br><span class="line">html_content = loader.render_to_string(</span><br><span class="line">                     template_path,               <span class="comment">#需要渲染的html模板</span></span><br><span class="line">                     &#123;</span><br><span class="line">                        ‘paramters’:paramters    <span class="comment">#参数</span></span><br><span class="line">                     &#125;</span><br><span class="line">               )</span><br><span class="line"></span><br><span class="line">send_html_mail(subject, html_content, [收件人列表]):</span><br></pre></td></tr></table></figure>
<h2 id="环境部署"><a class="markdownIt-Anchor" href="#环境部署"></a> 环境部署</h2>
<p>项目部署是指在软件开发完毕后，将开发机器上运行的软件实际安装到服务器上进行长期运行<br />
1.在安装机器上安装和配置同版本的环境[py,数据库等</p>
<p>2.django 项目迁移</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo scp /home/tarena/django/mysite1</span><br><span class="line">root@88.77.66.55; / home /root/xxx</span><br><span class="line">请输入root密码:</span><br></pre></td></tr></table></figure>
<p>3.用uwSGI替代python3 <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver 方法启动服务器<br />
4.配置nginx反向代理服务器<br />
5.用nginx配置静态文件路径,解决静态路径问题</p>
<p>wSGl (Web Server Gateway Interface)Web服务器网关接口，是<br />
Python应用程序或框架和Web服务器之间的一种接口，被广泛使用<br />
使用python <a href="http://manage.py" target="_blank" rel="noopener">manage.py</a> runserver通常只在开发和测试环境中使用<br />
当开发结束后，完善的项目代码需要在一个高效稳定的环境中运行，这时可以使用WSGl</p>
<p>uwSGI是wSGl的一种,它实现了http协议wSGI协议以及uwsgi协议<br />
uwSGI功能完善，支持协议众多，在python web圈热度极高<br />
uwSGI主要以学习配置为主</p>
<p>Ubuntu执行sudo pip3 install uwsgi==2.0.18 -i<br />
<a href="https://pypi.tuna.tsinghua.edu.cn/simple/" target="_blank" rel="noopener">https://pypi.tuna.tsinghua.edu.cn/simple/</a></p>
<p>检查是否安装成功<br />
sudo pip3 freezelgrep -i ‘uwsgi’<br />
如果成功安装，则会输出uwSGI==2.0.1</p>
<p>添加配置文件项目同名文件夹/uwsgi.ini<br />
如: mysite1/mysite1/uwsgi.ini<br />
文件以[uwsgi]开头，有如下配置项:套接字方式的IP地址:端口号【此模式需要有nginx】<br />
socket=127.0.0.1:8000<br />
Http通信方式的IP地址:端口号<br />
http=127.0.0.1:8000</p>
<p>项目当前工作目录<br />
chdir=/home/tarenal…/my_project</p>
<p>项目中wsgi.py文件的目录，相对于当前工作目录<br />
wsgi-file=my_project/wsgi.py</p>
<p>进程个数<br />
process=4</p>
<p>每个进程的线程个数<br />
threads=2</p>
<p>服务的pid记录文件<br />
pidfile=uwsgi.pid</p>
<p>服务的目志文件位置<br />
daemonize=uwsgi.log</p>
<p>开启主进程管理模式<br />
master=true</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[uwsgi]</span></span><br><span class="line"><span class="attr">http</span>=<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">8000</span></span><br><span class="line"><span class="attr">chdir</span>=/../../project</span><br><span class="line"><span class="attr">wsgi-file</span>=project/wsgi.py</span><br><span class="line"><span class="attr">process</span>=<span class="number">4</span> <span class="comment">#cpu核数</span></span><br><span class="line"><span class="attr">threads</span>=<span class="number">2</span></span><br><span class="line"><span class="attr">pidfile</span>=uwsgi.pid</span><br><span class="line"><span class="attr">daemonize</span>=uwsgi.log</span><br><span class="line"><span class="attr">master</span>=<span class="literal">True</span></span><br></pre></td></tr></table></figure>
<p>启动uwsgi<br />
cd 到 uwSGI配置文件所在目录</p>
<p>uwsgi --ini uwsgi.ini</p>
<p>停止uwsgi<br />
cd 到uwSGI配置文件所在目录</p>
<p>uwsgi --stop uwsgi.pid</p>
<p>1，无论是启动还是关闭，都需要执行ps aux|grep 'uwsgi’确认是否符合预期<br />
2，启动成功后，进程在后台执行,所有日志均输出在配置文件所在目录的uwsgi.log中<br />
3,Django中代码有任何修改，需要重新启动uwsgi</p>
<h2 id="redis"><a class="markdownIt-Anchor" href="#redis"></a> redis</h2>
<p>Redis是非关系型的kv型数据库<br />
·特点:<br />
1、开源的,使用C编写，基于内存且支持持久化</p>
<p>2、支持数据类型丰富，字符串strings，散列hashes，列表lists，集合sets,有序集合sorted sets等等</p>
<p>3、支持多种编程语言(CC++ Python Java PHP …)</p>
<p>4、单进程单线程</p>
<p>1、持久化<br />
将内存中数据保存到磁盘中，保证数据安全，方便进行数据备份和恢复</p>
<p>2、过期键功能<br />
为键设置一个过期时间，让它在指定时间内自动删除&lt;节省内存空间&gt;<br />
#音乐播放器，日播放排名，过期自动删除</p>
<p>3、事务功能<br />
弱事务型的数据库，只是具备简单的事务功能</p>
<p>4、主从复制<br />
如何让redis保持高可用状态，官方提供主从搭建方案</p>
<p>5、Sentinel哨兵<br />
在搭配了基础的主从结构后，哨兵可做到自动故障转移</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-benchmark -q -n 10000</span><br></pre></td></tr></table></figure>
<p>Ubuntu<br />
安装: sudo apt-get install redis-server<br />
安装后, Ubuntu会将redis列为开机自动启动项</p>
<p>服务端启动/停止/重启:<br />
sudo /etc/init.d/redis-server status | start | stop | restart</p>
<p>客户端连接<br />
redis-cli -h IP地址 -p 6379 -a 密码</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli #进入服务</span><br><span class="line">ping #校验是否进入服务</span><br><span class="line">pong</span><br></pre></td></tr></table></figure>
<p>·配置文件所在路径letc/redis/redis.conf<br />
mysql的配置文件在哪里?<br />
/etc/mysql/mysql.conf.d/mysqld.cnf</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/redis/redis.conf /etc/redis/redis_bak.conf  #备份</span><br><span class="line">sudo chown redis:redis /etc/redis/redis_bak.conf  #更改权限</span><br></pre></td></tr></table></figure>
<p>配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">requirepass 密码</span><br><span class="line">sudo &#x2F;etc&#x2F;init.d&#x2F;redis-server restart启动服务</span><br><span class="line">redis-cli -h IP地址 -p 6379 -a 密码</span><br></pre></td></tr></table></figure>
<h2 id="项目"><a class="markdownIt-Anchor" href="#项目"></a> 项目</h2>
<p>笔记项目</p>
<ul>
<li>产品/运营经理:负责产品功能细节的把控</li>
<li>开发<br />
前端–负责显示部分内容的开发【多】<br />
后端–负责服务器部分的功能开发【少】<br />
运维–管理linux服务器，组件化配置</li>
<li>安全问题</li>
<li>测试–负责找出产品功能的问题（BUG)·美术-负责产品素材方面得绘制</li>
</ul>
<p>登录界面视图</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 接收到get返回页面</span></span><br><span class="line">print(request.POST)</span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user/index.html'</span>)</span><br><span class="line"><span class="comment"># 接收到post处理数据</span></span><br><span class="line"><span class="keyword">elif</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">    user_name = request.POST[<span class="string">'UserName'</span>]</span><br><span class="line">    email = request.POST[<span class="string">'Email'</span>]</span><br><span class="line">    password = request.POST[<span class="string">'Password'</span>]</span><br><span class="line">    <span class="comment"># 判断密码重复是否正确</span></span><br><span class="line">    <span class="keyword">if</span> password != request.POST[<span class="string">'ConfirmPassword'</span>]:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'非法操作'</span>)</span><br><span class="line">    <span class="comment"># 判断是否已经有用户名</span></span><br><span class="line">    old_user_name = User.objects.filter(user_name=user_name)</span><br><span class="line">    <span class="keyword">if</span> old_user_name:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'用户已经注册'</span>)</span><br><span class="line">    <span class="comment"># 判断邮箱是否已经存在</span></span><br><span class="line">    old_email = User.objects.filter(email=email)</span><br><span class="line">    <span class="keyword">if</span> old_email:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'邮箱已经注册'</span>)</span><br><span class="line">    <span class="comment">#密码加密</span></span><br><span class="line">    hash_key = hashlib.md5()</span><br><span class="line">    hash_key.update(password.encode())</span><br><span class="line">    hash_key = hash_key.hexdigest()</span><br><span class="line">    hash_key += <span class="string">"note"</span> <span class="comment">#二次加密加字符串</span></span><br><span class="line">    hash_key_again = hashlib.md5()</span><br><span class="line">    hash_key_again.update(password.encode())</span><br><span class="line">    hash_password = hash_key_again.hexdigest()</span><br><span class="line">    <span class="comment"># 写入数据库</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">       user =  User.objects.create(user_name=user_name, password=hash_password, email=email)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> HttpResponse(<span class="string">'用户名已注册'</span>)</span><br><span class="line">    request.session[<span class="string">'uname'</span>] = user_name  <span class="comment">#设置session</span></span><br><span class="line">    request.session[<span class="string">'uid'</span>] = user.id</span><br><span class="line">    <span class="keyword">return</span> render(request, <span class="string">'user/success.html'</span>)</span><br></pre></td></tr></table></figure>
<p>​	装饰器校验账户是否登录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定义装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_login</span><span class="params">(fn)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrap</span><span class="params">(request, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="comment"># if not request.session.get('username') or not request.session.get('uid'):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.session <span class="keyword">or</span> <span class="string">'uid'</span> <span class="keyword">not</span> <span class="keyword">in</span> request.session:</span><br><span class="line">            c_name = request.COOKIES.get(<span class="string">'uname'</span>)</span><br><span class="line">            c_id = request.COOKIES.get(<span class="string">'uid'</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> c_name <span class="keyword">or</span> <span class="keyword">not</span> c_id:</span><br><span class="line">                <span class="keyword">return</span> HttpResponseRedirect(<span class="string">'/user/login'</span>)</span><br><span class="line">            request.session[<span class="string">'username'</span>] = c_name</span><br><span class="line">            request.session[<span class="string">'uid'</span>] = c_id</span><br><span class="line">        <span class="keyword">return</span> fn(request, *args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrap</span><br></pre></td></tr></table></figure>
<p>退出登录</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_out</span><span class="params">(request)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> request.session:</span><br><span class="line">        <span class="keyword">del</span> request.session[<span class="string">'username'</span>]</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'uid'</span> <span class="keyword">in</span> request.session:</span><br><span class="line">        <span class="keyword">del</span> request.session[<span class="string">'uid'</span>]</span><br><span class="line">    resp = HttpResponseRedirect(<span class="string">'/user/login'</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">'uname'</span> <span class="keyword">in</span> request.COOKIES:</span><br><span class="line">        resp.delete_cookie(<span class="string">'uname'</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">'uid'</span> <span class="keyword">in</span> request.COOKIES:</span><br><span class="line">        resp.delete_cookie(<span class="string">'uid'</span>)</span><br><span class="line">    <span class="keyword">return</span> resp</span><br></pre></td></tr></table></figure>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:1215057638@qq.com">Blosslom&amp;纽扣</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://blosslom1.github.io/2022/03/06/Django/">https://blosslom1.github.io/2022/03/06/Django/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blosslom1.github.io" target="_blank">星炎实验室</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/web/">web</a></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/django/head.jpg" data-sites="facebook,twitter,wechat,weibo,qq,qzone"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><a class="reward-button button--primary button--animated"> <i class="fa fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="/img/wechat.jpg" alt="微信"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="/img/alipay.jpg" alt="支付宝"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></a></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2021/11/04/%E6%A8%A1%E5%85%B7%E8%AE%BE%E8%AE%A1/"><img class="next_cover" src="https://cdn.jsdelivr.net/gh/jerryc127/CDN@latest/cover/default_bg3.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">模具设计</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2021/04/06/web前端/" title="web前端"><img class="relatedPosts_cover" src="https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/web/head.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2021-04-06</div><div class="relatedPosts_title">web前端</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail','link'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'lc8847x3oNmR8dHxovhJ6GsY-gzGzoHsz',
  appKey: 'LoauVB46UPl7cf05pvfIh0fj',
  notify: false,
  verify: false,
  placeholder: 'Please leave your footprints',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: false,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: true,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" style="background-image: url(https://cdn.jsdelivr.net/gh/Blosslom1/img1@master/django/head.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By Blosslom&纽扣</div><div class="framework-info"><span>驱动 </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="footer_custom_text">Chemistry world</div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="简繁转换" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a href="https://github.com/wzpan/hexo-generator-search" target="_blank" rel="noopener" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fa fa-times"></i></span></div><div class="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css"><script>$(function () {
  $('span.katex-display').wrap('<div class="katex-wrap"></div>')
})</script><script id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script id="canvas_nest" color="0,0,255" opacity="0.7" zIndex="-1" count="50" mobile="false" src="/js/third-party/canvas-nest.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="/js/third-party/ClickShowText.js"></script><script src="/js/search/local-search.js"></script></body></html>